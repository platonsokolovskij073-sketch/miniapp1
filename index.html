<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Stars & Premium ‚Äî MiniApp</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0e1020;
  --card:rgba(255,255,255,.06);
  --line:rgba(255,255,255,.10);
  --text:#eaf1ff;
  --muted:#a9b3c7;
  --accent:#6a8dff;
  --accent2:#2fe0a1;
  --danger:#ff5c7a;
  --ok:#5cff9c;
  --shadow:0 20px 40px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:"Inter",system-ui,Segoe UI,Roboto,Arial,sans-serif; color:var(--text);
  background:
    radial-gradient(1200px 500px at 10% -10%, rgba(106,141,255,.25), transparent 70%),
    radial-gradient(900px 500px at 110% 10%, rgba(47,224,161,.20), transparent 70%),
    var(--bg);
  display:flex; flex-direction:column;
}

/* Header */
.header{
  position:sticky; top:0; z-index:10;
  padding:12px 16px; display:flex; align-items:center; gap:12px;
  background:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.2));
  backdrop-filter:blur(14px) saturate(140%); -webkit-backdrop-filter:blur(14px) saturate(140%);
  border-bottom:1px solid var(--line);
}
.logo{width:36px; height:36px; border-radius:12px; display:grid; place-items:center; font-weight:800;
  background:conic-gradient(from 0deg, #9a7bff, #6a8dff,#54ffd1,#9a7bff); color:#080a12; box-shadow:var(--shadow)}
.title{font-weight:800; letter-spacing:.3px}
.subtitle{font-size:12px; color:var(--muted)}

/* Containers */
.container{padding:16px; display:none; animation:fade .25s ease forwards}
.container.active{display:block}
.grid{display:grid; gap:12px}
.grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
.card{
  background:var(--card); border:1px solid var(--line); border-radius:20px; padding:14px; box-shadow:var(--shadow);
  transition:.25s transform, .25s background, .25s box-shadow;
}
.card:hover{transform:translateY(-2px)}
.card h3{margin:.2rem 0 .4rem; font-size:16px}
.card p{margin:0; font-size:12px; color:var(--muted)}
.badge{font-size:12px; padding:6px 8px; border-radius:10px; background:rgba(255,255,255,.12); border:1px solid var(--line); color:var(--muted)}
.row{display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}

/* Buttons */
.btn{appearance:none; border:0; cursor:pointer; padding:10px 14px; border-radius:14px; font-weight:800; color:#fff;
  background:linear-gradient(135deg, var(--accent), #9a7bff); box-shadow:0 10px 24px rgba(106,141,255,.35); transition:transform .15s, filter .2s}
.btn:active{transform:scale(.98)}
.btn.ghost{background:transparent; color:var(--text); border:1px solid var(--line); box-shadow:none}
.btn.ok{background:linear-gradient(135deg, var(--accent2), #54ffd1); color:#042b1f; box-shadow:0 10px 24px rgba(47,224,161,.3)}
.btn.danger{background:linear-gradient(135deg, var(--danger), #ff8ea4)}
.price{font-weight:800}

/* Hero banner */
.banner{
  position:relative; overflow:hidden; border-radius:20px; height:140px; display:flex; align-items:center; padding:16px;
  background:linear-gradient(135deg, rgba(106,141,255,.25), rgba(47,224,161,.18));
  border:1px solid var(--line);
}
.banner img{position:absolute; right:-6px; bottom:-6px; height:160px; opacity:.25; filter:saturate(120%) blur(.2px)}
.banner h2{margin:0 0 6px 0}
.banner p{margin:0; color:var(--muted)}

/* Bottom nav */
.nav{
  position:sticky; bottom:0; z-index:10; display:grid; grid-template-columns:repeat(5,1fr); gap:8px; padding:10px;
  background:linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.55)); backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px);
  border-top:1px solid var(--line);
}
.tab{appearance:none; border:1px solid var(--line); background:rgba(255,255,255,.06); color:#fff; padding:10px 8px; border-radius:14px; font-size:12px}
.tab.active{background:linear-gradient(135deg, rgba(255,255,255,.16), rgba(255,255,255,.08))}

/* Slot machine */
.slot-wrap{display:grid; place-items:center; gap:10px}
.slot{
  width:280px; height:110px; border-radius:18px; overflow:hidden; position:relative;
  background:rgba(0,0,0,.35); border:1px solid var(--line); box-shadow:var(--shadow); display:grid; grid-template-columns:repeat(3,1fr); gap:8px; padding:8px;
}
.reel{background:rgba(255,255,255,.08); border:1px solid var(--line); border-radius:12px; display:grid; place-items:center; font-size:36px; font-weight:800}
.reel.spin{animation:spin 1.1s cubic-bezier(.2,.7,.2,1) infinite}
@keyframes spin{0%{transform:translateY(0)}100%{transform:translateY(-100%)}}

/* Confetti / Emoji rain */
.particle{position:fixed; top:-20px; font-size:22px; animation:fall linear forwards}
@keyframes fall{to{transform:translateY(105vh) rotate(360deg); opacity:.95}}

/* Toast */
.toast{position:fixed; left:50%; bottom:120px; transform:translateX(-50%) translateY(20px); background:rgba(0,0,0,.8);
  border:1px solid var(--line); color:#fff; padding:10px 14px; border-radius:12px; opacity:0; pointer-events:none; transition:opacity .2s, transform .2s; font-size:13px}
.toast.show{opacity:1; transform:translateX(-50%) translateY(0)}

/* Fade in */
@keyframes fade{from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:translateY(0)}}
.hidden{display:none}
.hr{height:1px; background:var(--line); margin:4px 0 0}
</style>
</head>
<body>
  <!-- HEADER -->
  <div class="header">
    <div class="logo">‚òÖ</div>
    <div>
      <div class="title">Stars & Premium</div>
      <div class="subtitle">–∑–≤—ë–∑–¥—ã ‚Ä¢ premium ‚Ä¢ –∏–≥—Ä—ã ‚Ä¢ —Ä–µ—Ñ–µ—Ä–∞–ª–∫–∞</div>
    </div>
    <div style="margin-left:auto" class="badge" id="userBadge">guest</div>
  </div>

  <!-- HOME -->
  <section class="container active" id="home">
    <div class="banner">
      <!-- OPTIONAL: banner image -->
      <!-- <img src="assets/banner.webp" alt=""> -->
      <div>
        <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å üëã</h2>
        <p>–ö—Ä–∞—Å–∏–≤—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏, –±—ã—Å—Ç—Ä—ã–µ –ø–æ–∫—É–ø–∫–∏ –∏ –Ω–µ–º–Ω–æ–≥–æ —Ñ–∞–Ω–∞.</p>
        <div class="row" style="margin-top:8px">
          <button class="btn ok" id="themeBtn">–ü–æ–¥—Ö–≤–∞—Ç–∏—Ç—å —Ç–µ–º—É</button>
          <button class="btn ghost" id="confettiBtn">–ö–æ–Ω—Ñ–µ—Ç—Ç–∏</button>
        </div>
      </div>
    </div>

    <div class="grid cols-2" style="margin-top:12px">
      <div class="card">
        <h3>–ö—É–ø–∏—Ç—å –∑–≤—ë–∑–¥—ã ‚≠ê</h3>
        <p>–í—ã–±–∏—Ä–∞–π –ø–∞–∫–µ—Ç—ã, –æ—Ñ–æ—Ä–º–ª—è–π –≤ 2 –∫–ª–∏–∫–∞.</p>
        <div class="row" style="margin-top:8px">
          <span class="badge">–∑–≤—ë–∑–¥—ã</span>
          <button class="btn" data-tab-go="stars">–ü–µ—Ä–µ–π—Ç–∏</button>
        </div>
      </div>

      <div class="card">
        <h3>Telegram Premium üíé</h3>
        <p>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –±–µ–∑ –ª–∏—à–Ω–∏—Ö —à–∞–≥–æ–≤.</p>
        <div class="row" style="margin-top:8px">
          <span class="badge">premium</span>
          <button class="btn" data-tab-go="premium">–ü–µ—Ä–µ–π—Ç–∏</button>
        </div>
      </div>

      <div class="card">
        <h3>–°–ª–æ—Ç-–º–∞—à–∏–Ω–∞ üé∞</h3>
        <p>–ú–∏–Ω–∏-–∏–≥—Ä–∞ —Å –≤–∏–±—Ä–æ –∏ –ø–æ–±–µ–¥–Ω—ã–º –≤—Å–ø–ª–µ—Å–∫–æ–º.</p>
        <div class="row" style="margin-top:8px">
          <span class="badge">—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–µ</span>
          <button class="btn" data-tab-go="games">–ò–≥—Ä–∞—Ç—å</button>
        </div>
      </div>

      <div class="card">
        <h3>–†–µ—Ñ–µ—Ä–∞–ª–∫–∞ ü§ù</h3>
        <p>–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π –∏ –∑–∞–±–∏—Ä–∞–π –±–æ–Ω—É—Å—ã.</p>
        <div class="row" style="margin-top:8px">
          <span class="badge">–¥–æ 10%</span>
          <button class="btn" data-tab-go="ref">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
        </div>
      </div>
    </div>
  </section>

  <!-- STARS -->
  <section class="container" id="stars">
    <div class="card">
      <!-- OPTIONAL: banner image -->
      <!-- <img src="assets/stars.webp" alt="" style="width:100%; border-radius:12px; opacity:.9; margin-bottom:10px"> -->
      <h3>–ü–∞–∫–µ—Ç—ã –∑–≤—ë–∑–¥ ‚≠ê</h3>
      <p>–ö–Ω–æ–ø–∫–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω—ã, –ø–æ–∫—É–ø–∫–∞ ‚Äî –¥–µ–º–æ (–∑–∞–≥–ª—É—à–∫–∞).</p>
      <div class="hr"></div>
      <div class="grid cols-2" id="starsList"></div>
      <div class="row" style="margin-top:12px">
        <span class="badge" id="starsTotal">–ò—Ç–æ–≥–æ: 0 ‚≠ê</span>
        <button class="btn ghost" id="starsClear">–°–±—Ä–æ—Å–∏—Ç—å</button>
      </div>
    </div>
  </section>

  <!-- PREMIUM -->
  <section class="container" id="premium">
    <div class="card">
      <!-- OPTIONAL: banner image -->
      <!-- <img src="assets/premium.webp" alt="" style="width:100%; border-radius:12px; opacity:.9; margin-bottom:10px"> -->
      <h3>Telegram Premium üíé</h3>
      <p>–í—ã–±–µ—Ä–∏ –ø–µ—Ä–∏–æ–¥ –∏ –æ—Ñ–æ—Ä–º–∏ –≤ –æ–¥–∏–Ω —Ç–∞–ø.</p>
      <div class="hr"></div>
      <div class="grid cols-2">
        <div class="card">
          <h3>1 –º–µ—Å—è—Ü</h3>
          <p>–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</p>
          <div class="row" style="margin-top:8px">
            <span class="price">~ 499 ‚ÇΩ</span>
            <button class="btn buy-premium" data-plan="1m">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
          </div>
        </div>
        <div class="card">
          <h3>3 –º–µ—Å—è—Ü–∞</h3>
          <p>–ù–µ–±–æ–ª—å—à–∞—è —ç–∫–æ–Ω–æ–º–∏—è</p>
          <div class="row" style="margin-top:8px">
            <span class="price">~ 1 399 ‚ÇΩ</span>
            <button class="btn buy-premium" data-plan="3m">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
          </div>
        </div>
        <div class="card">
          <h3>6 –º–µ—Å—è—Ü–µ–≤</h3>
          <p>–û–ø—Ç–∏–º–∞–ª—å–Ω–æ</p>
          <div class="row" style="margin-top:8px">
            <span class="price">~ 2 699 ‚ÇΩ</span>
            <button class="btn buy-premium" data-plan="6m">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
          </div>
        </div>
        <div class="card">
          <h3>12 –º–µ—Å—è—Ü–µ–≤</h3>
          <p>–ú–∞–∫—Å–∏–º—É–º –≤—ã–≥–æ–¥—ã</p>
          <div class="row" style="margin-top:8px">
            <span class="price">~ 4 999 ‚ÇΩ</span>
            <button class="btn buy-premium" data-plan="12m">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- GAMES -->
  <section class="container" id="games">
    <div class="card slot-wrap">
      <h3>–°–ª–æ—Ç-–º–∞—à–∏–Ω–∞ üé∞</h3>
      <p>–ù–∞–∂–º–∏ ¬´Spin¬ª ‚Äî —Ç—Ä–∏ –±–∞—Ä–∞–±–∞–Ω–∞ –∫—Ä—É—Ç—è—Ç—Å—è, —Ä–∞–Ω–¥–æ–º –≤—ã–¥–∞—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü–æ–±–µ–¥–∞ ‚Äî –∫–æ–Ω—Ñ–µ—Ç—Ç–∏!</p>
      <div class="slot" id="slot">
        <div class="reel" id="reel1">‚òÖ</div>
        <div class="reel" id="reel2">üíé</div>
        <div class="reel" id="reel3">‚ö°</div>
      </div>
      <div class="row">
        <button class="btn ok" id="spinBtn">Spin</button>
        <button class="btn ghost" id="emojiRain">–≠–º–æ–¥–∂–∏-–¥–æ–∂–¥—å</button>
      </div>
      <span class="badge" id="slotOut">–£–¥–∞—á–∏!</span>
    </div>
  </section>

  <!-- REFERRAL -->
  <section class="container" id="ref">
    <div class="card">
      <h3>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ ü§ù</h3>
      <p>–ü–æ–¥–µ–ª–∏—Å—å —Å—Å—ã–ª–∫–æ–π ‚Äî –¥—Ä—É–≥ –ø–æ–ª—É—á–∞–µ—Ç —Å–∫–∏–¥–∫—É, —Ç—ã ‚Äî –±–æ–Ω—É—Å –∑–≤—ë–∑–¥–∞–º–∏.</p>
      <div class="hr"></div>
      <div class="row" style="margin-top:8px">
        <span class="badge" id="refLink">–≤–∞—à–∞ —Å—Å—ã–ª–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è —Ç—É—Ç</span>
        <button class="btn" id="copyRef">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>
      <div class="row" style="margin-top:8px">
        <button class="btn ghost">–ú–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã (0)</button>
        <button class="btn ghost">–ü—Ä–∞–≤–∏–ª–∞</button>
      </div>
    </div>
  </section>

  <!-- PROFILE -->
  <section class="container" id="profile">
    <div class="card">
      <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
      <p id="whoami">–ò–º—è –∏ –Ω–∏–∫ –ø–æ–¥—Ç—è–Ω–µ–º –∏–∑ Telegram, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ.</p>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="sendOrder">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑ –±–æ—Ç—É</button>
        <button class="btn ghost" id="closeBtn">–ó–∞–∫—Ä—ã—Ç—å MiniApp</button>
      </div>
    </div>
  </section>

  <!-- NAV -->
  <nav class="nav">
    <button class="tab active" data-tab="home">üè† –î–æ–º</button>
    <button class="tab" data-tab="stars">‚≠ê –ó–≤—ë–∑–¥—ã</button>
    <button class="tab" data-tab="premium">üíé Premium</button>
    <button class="tab" data-tab="games">üéÆ –ò–≥—Ä—ã</button>
    <button class="tab" data-tab="ref">ü§ù –†–µ—Ñ–µ—Ä–∞–ª–∫–∞</button>
  </nav>

  <div class="toast" id="toast">–ì–æ—Ç–æ–≤–æ!</div>

<script>
const tg = window.Telegram?.WebApp;

// THEME –∞–¥–∞–ø—Ç–∞—Ü–∏—è
function applyTheme(){
  if(!tg) return;
  const t = tg.themeParams || {};
  document.documentElement.style.setProperty('--bg', t.bg_color || '#0e1020');
  document.documentElement.style.setProperty('--text', t.text_color || '#eaf1ff');
  document.documentElement.style.setProperty('--line', t.section_separator_color || 'rgba(255,255,255,.10)');
  // —Ç–µ–ª–µ–≥—Ä–∞–º —Å–∞–º –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –∫–Ω–æ–ø–∫–∏/—Å—Ç–∞—Ç—É—Å-–±–∞—Ä
}

// UI helpers
const showToast = (msg='–ì–æ—Ç–æ–≤–æ!')=>{
  const el = document.getElementById('toast');
  el.textContent = msg; el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'), 1500);
  try{ navigator.vibrate?.(20); tg?.HapticFeedback?.notificationOccurred('success'); }catch{}
};
const confetti = ()=>{
  const icons = ['‚ú®','‚≠ê','üíé','üéâ','‚ö°','ü™Ñ','üåü'];
  for(let i=0;i<30;i++){
    const s = document.createElement('div');
    s.className='particle'; s.textContent=icons[Math.floor(Math.random()*icons.length)];
    s.style.left = Math.random()*100+'vw';
    s.style.animationDuration = (1.2+Math.random()*1.2)+'s';
    document.body.appendChild(s);
    setTimeout(()=>s.remove(), 2600);
  }
};

// –ù–∞–≤–∏–≥–∞—Ü–∏—è
const tabs = [...document.querySelectorAll('.tab')];
const sections = [...document.querySelectorAll('.container')];
function openTab(id){
  tabs.forEach(t=>t.classList.toggle('active', t.dataset.tab===id));
  sections.forEach(s=>s.classList.toggle('active', s.id===id));
  tg?.BackButton?.show();
}
tabs.forEach(t=>t.addEventListener('click', ()=>openTab(t.dataset.tab)));
document.querySelectorAll('[data-tab-go]').forEach(b=>b.onclick=()=>openTab(b.dataset.tabGo));
tg?.BackButton?.onClick(()=>openTab('home'));

// HOME actions
document.getElementById('themeBtn').onclick=()=>{applyTheme(); showToast('–¢–µ–º–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞');};
document.getElementById('confettiBtn').onclick=()=>{confetti();};

// USER info
(function hydrateUser(){
  try{
    const user = tg?.initDataUnsafe?.user;
    if(user){
      document.getElementById('userBadge').textContent = user.username ? '@'+user.username : (user.first_name||'user');
      document.getElementById('whoami').textContent = `–¢—ã: ${user.first_name||''} ${user.last_name||''} ${user.username?'(@'+user.username+')':''}`;
    }
  }catch{}
})();

// –ó–≤—ë–∑–¥—ã (–¥–µ–º–æ-–∫–∞—Ç–∞–ª–æ–≥)
const starPacks = [
  {id:'s100', name:'100 ‚≠ê', price:'~ 99 ‚ÇΩ'},
  {id:'s500', name:'500 ‚≠ê', price:'~ 459 ‚ÇΩ'},
  {id:'s1000', name:'1000 ‚≠ê', price:'~ 899 ‚ÇΩ'},
  {id:'s2500', name:'2500 ‚≠ê', price:'~ 2190 ‚ÇΩ'},
  {id:'s5000', name:'5000 ‚≠ê', price:'~ 4290 ‚ÇΩ'},
  {id:'s10000', name:'10000 ‚≠ê', price:'~ 8390 ‚ÇΩ'},
];
let starsQty = 0;
const starsList = document.getElementById('starsList');
const starsTotal = document.getElementById('starsTotal');
const starsClear = document.getElementById('starsClear');
starPacks.forEach(p=>{
  const c = document.createElement('div');
  c.className='card';
  c.innerHTML = `<h3>${p.name}</h3><p>–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ</p>
    <div class="row" style="margin-top:8px">
      <span class="price">${p.price}</span>
      <button class="btn buy-stars" data-id="${p.id}">–ö—É–ø–∏—Ç—å</button>
    </div>`;
  starsList.appendChild(c);
});
starsList.addEventListener('click', (e)=>{
  const btn = e.target.closest('.buy-stars'); if(!btn) return;
  starsQty++; starsTotal.textContent = `–ò—Ç–æ–≥–æ: ${starsQty} –ø–æ–∑.`;
  tg?.HapticFeedback?.impactOccurred('light');
  showToast('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∑–∞–∫–∞–∑');
  tg?.MainButton?.setText('–û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–∫—É–ø–∫—É ‚≠ê').show();
});
starsClear.onclick=()=>{starsQty=0; starsTotal.textContent='–ò—Ç–æ–≥–æ: 0 ‚≠ê'; tg?.MainButton?.hide(); showToast('–°–±—Ä–æ—à–µ–Ω–æ')};

// Premium (–∑–∞–≥–ª—É—à–∫–∏)
document.querySelectorAll('.buy-premium').forEach(b=>b.onclick=()=>{
  tg?.MainButton?.setText('–û—Ñ–æ—Ä–º–∏—Ç—å Premium').show();
  showToast('Premium –¥–æ–±–∞–≤–ª–µ–Ω');
  tg?.HapticFeedback?.impactOccurred('rigid');
});

// Slot-machine
const symbols = ['‚òÖ','üíé','‚ö°','7Ô∏è‚É£','üçÄ','ü™ô'];
const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3')];
const spinBtn = document.getElementById('spinBtn');
const slotOut = document.getElementById('slotOut');
function randSym(){ return symbols[Math.floor(Math.random()*symbols.length)]; }
let spinning = false;
spinBtn.onclick = ()=>{
  if(spinning) return;
  spinning = true; slotOut.textContent='–ö—Ä—É—Ç–∏–º...'; spinBtn.disabled=true;
  reels.forEach(r=>{ r.classList.add('spin'); r.textContent = randSym(); });
  tg?.HapticFeedback?.impactOccurred('medium');
  setTimeout(()=>{
    reels.forEach(r=>r.classList.remove('spin'));
    const res = [randSym(),randSym(),randSym()];
    reels.forEach((r,i)=>r.textContent=res[i]);
    const win = res[0]===res[1] && res[1]===res[2];
    if(win){ slotOut.textContent='–ü–æ–±–µ–¥–∞! üéâ'; confetti(); tg?.HapticFeedback?.notificationOccurred('success'); }
    else { slotOut.textContent='–ü–æ–≤–µ–∑—ë—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑!'; }
    spinBtn.disabled=false; spinning=false;
  }, 1400);
};

// Emoji rain
document.getElementById('emojiRain').onclick=()=>{
  const emo = ['üåü','üí•','‚ú®','üéâ','üí´','ü™Ñ','üíé','‚ö°'];
  for(let i=0;i<24;i++){
    const p=document.createElement('div'); p.className='particle';
    p.textContent = emo[Math.floor(Math.random()*emo.length)];
    p.style.left = Math.random()*100+'vw';
    p.style.animationDuration = (1.1+Math.random()*1.3)+'s';
    document.body.appendChild(p);
    setTimeout(()=>p.remove(), 2400);
  }
};

// Referral
const refSpan = document.getElementById('refLink');
const copyRef = document.getElementById('copyRef');
(function buildRef(){
  const uid = tg?.initDataUnsafe?.user?.id || Math.floor(Math.random()*1e8);
  const link = `https://t.me/${tg?.initDataUnsafe?.receiver?.username || 'your_bot_here'}?start=ref_${uid}`;
  refSpan.textContent = link;
})();
copyRef.onclick=async()=>{
  try{
    await navigator.clipboard.writeText(refSpan.textContent);
    showToast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞');
  }catch{ showToast('–°–∫–æ–ø–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é'); }
};

// Profile actions
document.getElementById('sendOrder').onclick=()=>{
  // –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–≥–ª—É—à–∫–∏ –≤ –±–æ—Ç
  tg?.sendData?.(JSON.stringify({type:'order_demo', starsQty, premium:true}));
  showToast('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –±–æ—Ç—É'); tg?.HapticFeedback?.impactOccurred('soft');
};
document.getElementById('closeBtn').onclick=()=>tg?.close?.();

// Global: MainButton –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–¥–µ–º–æ)
tg?.MainButton?.onClick(()=>{ showToast('–ó–∞–≥–ª—É—à–∫–∞ –æ–ø–ª–∞—Ç—ã'); });

// BackButton –ª–æ–≥–∏–∫–∞
tg?.BackButton?.onClick(()=>openTab('home'));

// –ø–µ—Ä–≤–∏—á–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
(function init(){
  applyTheme();
  tg?.ready?.();
  tg?.expand?.();
  // –±—ã—Å—Ç—Ä—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Å –≥–ª–∞–≤–Ω–æ–π
  document.querySelectorAll('[data-tab-go]').forEach(b=>b.addEventListener('click',()=>tg?.HapticFeedback?.selectionChanged()));
})();
</script>
</body>
</html>
