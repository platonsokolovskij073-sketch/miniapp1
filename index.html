<!DOCTYPE html>
<html lang="ru" class="nocopy">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="color-scheme" content="dark light" />
<title>Starify ‚Äî MiniApp</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0a12; --bg2:#161427; --text:#f7f4ff; --muted:#b7abc9;
  --line:rgba(255,255,255,.10); --card:rgba(255,255,255,.06);
  --orange:#38bdf8; --orange2:#a5f3fc;
  --violet:#6366f1; --violet2:#a5b4fc;
  --danger:#ff3b6b; --ok:#35ffb1; --shadow:0 20px 40px rgba(0,0,0,.35);
  --sym:56px; --cup-w: 92px; --cup-h: 86px;
}

html.nocopy, html.nocopy body, html.nocopy *:not(input):not(textarea){
  -webkit-user-select:none; user-select:none; -webkit-touch-callout:none;
}
html.nocopy ::selection{background:transparent}
html,body{height:100%; overflow:hidden;}
*{box-sizing:border-box}

body{
  margin:0; font-family:"Inter",system-ui,Segoe UI,Roboto,Arial,sans-serif; color:var(--text);
  background:radial-gradient(circle at top, #1e293b, #020617 55%);
  display:flex; flex-direction:column; overscroll-behavior:none;
}
.header{
  position:sticky; top:0; z-index:10; padding:14px 16px;
  display:flex; align-items:center; gap:12px;
  background:rgba(0,0,0,.55);
  backdrop-filter:blur(14px) saturate(140%); -webkit-backdrop-filter:blur(14px) saturate(140%);
  border-bottom:1px solid var(--line);
}
.page{flex:1; display:flex; flex-direction:column; overflow-y:auto;}
.container{
  width:100%; max-width:920px; margin:0 auto;
  padding:14px 14px 90px; display:none; animation:fade .25s ease forwards;
}
.container.active{display:block}
.logo{
  width:36px; height:36px; border-radius:12px; display:grid; place-items:center; font-weight:800;
  background:conic-gradient(from 0deg, #e5f9ff, #38bdf8, #6366f1, #e5f9ff);
  color:#020617; box-shadow:var(--shadow);
}
.title{font-weight:800; letter-spacing:.3px}
.subtitle{font-size:12px; color:var(--muted)}
.grid{display:grid; gap:12px}
.grid.cols-2{grid-template-columns:1fr}
@media (min-width:560px){ .grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))} }
.card{
  background:var(--card); border:1px solid var(--line); border-radius:18px; padding:14px;
  box-shadow:var(--shadow); transition:.25s transform;
}
.card:hover{transform:translateY(-2px)}
.card h3{margin:.2rem 0 .4rem; font-size:16px}
.card p{margin:0; font-size:12px; color:var(--muted)}
.hr{height:1px; background:var(--line); margin:8px 0 2px}
.row{display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
.tile{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px; border-radius:14px; background:rgba(255,255,255,.06); border:1px solid var(--line)}
.input{
  width:100%; padding:12px 12px; border-radius:14px;
  border:1px solid var(--line); background:rgba(255,255,255,.06);
  color:var(--text); outline:none;
}
.input:focus{ border-color: rgba(56,189,248,.6); box-shadow:0 0 0 6px rgba(56,189,248,.18); }
.btn{
  appearance:none; border:0; cursor:pointer; padding:12px 14px; border-radius:14px; font-weight:800;
  color:#020617; background:linear-gradient(135deg, var(--orange), var(--orange2));
  box-shadow:0 12px 26px rgba(15,118,178,.45);
  transition:transform .12s,filter .2s, box-shadow .2s, opacity .2s, background-position .4s ease;
}
.btn:active{transform:scale(.98)}
.btn:hover{ transform:translateY(-1px); background-position: 100% 0; box-shadow:0 16px 34px rgba(15,118,178,.6); }
.btn.purple{background:linear-gradient(135deg, var(--violet), var(--violet2)); color:#f9f5ff; box-shadow:0 12px 26px rgba(79,70,229,.45)}
.btn.purple:hover{ background-position: 0 100%; box-shadow:0 16px 34px rgba(79,70,229,.6); }
.btn.ghost{background:transparent; color:var(--text); border:1px solid var(--line); box-shadow:none}
.btn[disabled]{opacity:.5; pointer-events:none}
.badge{font-size:12px; padding:6px 8px; border-radius:10px; background:rgba(255,255,255,.10); border:1px solid var(--line); color:var(--muted)}
.bigbtn{display:flex; gap:12px}
.bigbtn .btn{flex:1; font-size:15px}
.nav{
  position:sticky; bottom:0; z-index:10; display:grid; grid-template-columns:repeat(6,1fr);
  gap:8px; padding:10px; background:rgba(0,0,0,.55);
  backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px); border-top:1px solid var(--line);
}
.tab{
  appearance:none; border:1px solid var(--line); background:rgba(255,255,255,.06); color:#fff;
  padding:12px 8px; border-radius:16px; font-size:12px; display:flex; flex-direction:column; align-items:center; gap:4px
}
.tab span{opacity:.85; font-size:11px}
.tab.active{background:linear-gradient(135deg, rgba(56,189,248,.22), rgba(99,102,241,.22))}
.gbtn{position:relative}
.gbtn.active{outline:2px solid #38bdf8; box-shadow:0 0 0 6px rgba(56,189,248,.25)}
.stage{
  position:relative; height:260px; border-radius:16px; background:rgba(255,255,255,.05);
  border:1px solid var(--line); overflow:hidden; touch-action:none;
}
.banners{display:grid; gap:12px}
@media(min-width:560px){ .banners{grid-template-columns:1fr 1fr} }
.banner{
  position:relative; border-radius:16px; overflow:hidden; border:1px solid var(--line);
  background-size:cover; background-position:center; height:140px;
  display:grid; place-items:center; color:#fff; box-shadow:var(--shadow)
}
.banner .tag{position:absolute; left:12px; top:12px; padding:6px 8px; border-radius:10px; background:rgba(0,0,0,.5); border:1px solid var(--line); font-size:12px}
.slot-wrap{display:grid; place-items:center; gap:10px}
.simple-slot{
  position:relative; width:310px; border-radius:16px; overflow:hidden;
  background:radial-gradient(circle at top, #1d3557, #020617);
  border:1px solid var(--line); box-shadow:var(--shadow);
  display:grid; grid-template-columns:repeat(3,1fr); gap:8px; padding:8px;
  height: calc(var(--sym)*3 + 16px);
}
.reel{position:relative; overflow:hidden; border-radius:12px; border:1px solid var(--line); background:linear-gradient(180deg, rgba(148,210,255,.18),rgba(15,23,42,1)); height:calc(var(--sym)*3)}
.roller{position:absolute; left:0; right:0; top:0; will-change:transform}
.symbol{height:var(--sym); display:grid; place-items:center; font-size:42px; line-height:1}

/* ‚Äî‚Äî‚Äî CUPS ‚Äî‚Äî‚Äî */
.cups-ui{display:flex; gap:10px; margin-top:8px}
.cup{position:absolute; width:var(--cup-w); height:var(--cup-h); will-change:transform; z-index:2; transition:transform .22s ease; border-radius:24px; transform-style:preserve-3d}
.cup::before{
  content:""; position:absolute; inset:4px 10px 8px;
  background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(148,210,255,.7));
  border:1px solid rgba(15,23,42,.4);
  box-shadow: inset 0 10px 18px rgba(255,255,255,.3), inset 0 -12px 22px rgba(15,23,42,.45);
  border-radius: 28px / 22px;
  clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%);
  background-color: #dbeafe;
  transition: background-color 0.3s ease;
}
.cup.cup--color1::before { background-color: #bfdbfe; }
.cup.cup--color2::before { background-color: #e0f2fe; }
.cup.cup--color3::before { background-color: #c7d2fe; }

.cup::after{
  content:""; position:absolute; left:50%; transform:translateX(-50%);
  width:78%; height:8px; bottom:4px; border-radius:50%;
  background:radial-gradient(closest-side, rgba(0,0,0,.35), transparent 70%);
}
.ball-sm{
  position:absolute; width:24px; height:24px; border-radius:50%;
  background:radial-gradient(circle at 30% 30%, #fbbf24, #f97316);
  box-shadow:0 8px 14px rgba(0,0,0,.35), inset 0 2px 4px rgba(255,255,255,.45);
  will-change:transform; z-index:1; transition:transform .22s ease, opacity .12s ease;
}

/* ‚Äî‚Äî‚Äî WHEEL ‚Äî‚Äî‚Äî */
.wheel-wrapper{
  position:relative; width: 240px; height: 240px;
  margin: auto; margin-top:10px;
  display:grid; place-items:center;
}
.wheel-pointer{
  position:absolute; top: -2px; left: 50%; transform: translateX(-50%);
  width: 24px; height: 8px; border-radius: 4px;
  background-color: #38bdf8;
  box-shadow: 0 0 10px #38bdf8, 0 0 20px #38bdf8;
  z-index: 10;
}
.wheel-container{
  position:absolute; width:100%; height:100%;
  border-radius:50%;
  box-shadow: inset 0 0 20px rgba(0,0,0,.6), 0 0 0 6px #1f2933;
  border: 1px solid #1f2933;
  background: radial-gradient(circle at 30% 20%, rgba(56,189,248,.25), transparent 55%),
              radial-gradient(circle at 70% 80%, rgba(129,140,248,.25), transparent 55%),
              rgba(15,23,42,.85);
}
.wheel-container::before{
  content:"";
  position:absolute;
  inset:12px;
  border-radius:50%;
  border:1px dashed rgba(255,255,255,.18);
  box-shadow:0 0 18px rgba(0,0,0,.6);
}
.wheel-svg{
  width:100%; height:100%;
  transform-origin:center;
}
.wheel-center{
  position:absolute; width: 56px; height: 56px;
  border-radius: 50%;
  background: radial-gradient(circle, #4f46e5, #111827);
  border: 2px solid rgba(255,255,255,.4);
  box-shadow: 0 0 18px rgba(0,0,0,.8), 0 0 18px rgba(56,189,248,.45);
}
.wheel-center::after{
  content:"SPIN";
  position:absolute; inset:0;
  display:grid; place-items:center;
  font-size:11px; letter-spacing:.16em;
  color:#e5f9ff;
  text-transform:uppercase;
}

/* —Å–µ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –∏–≥—Ä */
.games-grid{display:grid; gap:10px; grid-template-columns:1fr 1fr}
.games-grid .span2{ grid-column: 1 / span 2; display:flex; justify-content:center }
.games-grid .span2 .btn{ min-width:180px }

.free-badge{font-size:12px; padding:6px 8px; border-radius:10px; background:rgba(255,255,255,.10); border:1px solid var(--line); color:#ffe082}
.bonus-bar{display:grid; grid-template-columns:repeat(7,1fr); gap:8px; margin-top:8px}
.bonus-day{height:28px; border-radius:12px; border:1px solid var(--line); display:grid; place-items:center; font-size:12px; color:#fff9; background:rgba(255,255,255,.04)}
.bonus-day.on{ background:linear-gradient(135deg, rgba(56,189,248,.35), rgba(99,102,241,.35)); color:#e5f9ff; font-weight:800 }
.toast{position:fixed; left:50%; bottom:120px; transform:translateX(-50%) translateY(20px); background:rgba(0,0,0,.8);
  border:1px solid var(--line); color:#fff; padding:10px 14px; border-radius:12px; opacity:0; pointer-events:none; transition:opacity .2s, transform .2s; font-size:13px}
.toast.show{opacity:1; transform:translateX(-50%) translateY(0)}
@keyframes fade{from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:translateY(0)}}

/* ===== OVERGO (–ø–æ—Ä—Ç –∞–Ω–∏–º–∞—Ü–∏–π) ===== */
.overgo { --stroke:#10162b; --muted:#9ca3af; --win:#22c55e; --win2:#86efac; --lose:#ef4444; }
.overgo .grid{display:grid; gap:12px}
@media(min-width:720px){ .overgo .grid{grid-template-columns:360px minmax(0,1fr)} }
.overgo .panel{border:1px solid var(--line); border-radius:18px; background:rgba(255,255,255,.05); padding:12px}
.overgo .title{font-size:12px; color:var(--muted); letter-spacing:.06em; text-transform:uppercase; margin-bottom:6px}
.overgo .field{display:flex; align-items:center; gap:8px; border:1px solid var(--line); border-radius:12px; padding:9px 12px; background:rgba(15,23,42,.9)}
.overgo input[type="number"], .overgo input[type="text"]{flex:1; border:0; outline:0; background:transparent; color:var(--text); font-size:15px}
.overgo .chips{display:flex; flex-wrap:wrap; gap:6px; margin-top:8px}
.overgo .chip{border:1px solid var(--line); background:#0a1228; color:#d1d5db; font-size:11px; border-radius:999px; padding:6px 10px; cursor:pointer; transition:.12s}
.overgo .chip:hover{transform:translateY(-1px); box-shadow:0 6px 16px rgba(34,197,94,.35); border-color:rgba(34,197,94,.5)}
.overgo .chip.danger{color:#fecaca}
.overgo .btn-main{margin-top:12px; width:100%}
.overgo .pills{display:flex; gap:8px; margin-top:12px}
.overgo .pill{flex:1; border:1px solid var(--line); border-radius:999px; padding:7px 10px; font-size:12px; color:var(--muted); display:flex; align-items:center; justify-content:space-between}
.overgo .statgrid{display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:8px}
.overgo .stat{border:1px solid var(--line); border-radius:12px; background:#0a1228; padding:9px 11px; font-size:11px; color:var(--muted); display:flex; flex-direction:column; gap:4px}
.overgo .screen{position:relative; margin-top:10px; border:1px solid var(--line); border-radius:14px; background:radial-gradient(circle at top, rgba(34,197,94,.18), rgba(7,16,38,1)); min-height:240px; display:grid; place-items:center; overflow:hidden}
.overgo .x{position:relative; z-index:1; font-weight:800; letter-spacing:.06em; font-size:clamp(44px,6.5vw,72px); transform-origin:center}
.overgo .x.win{color:#dcfce7; text-shadow:0 0 14px rgba(34,197,94,.55),0 0 40px rgba(34,197,94,.65)}
.overgo .x.lose{color:#fecaca; text-shadow:0 0 14px rgba(239,68,68,.45),0 0 40px rgba(239,68,68,.40)}
.overgo .glow{position:absolute; inset:-40%; background:radial-gradient(circle at center, rgba(34,197,94,.6), transparent 60%); pointer-events:none; opacity:0; transition:opacity .3s; mix-blend-mode:screen}
.overgo .screen.med .glow{opacity:.65; animation:rot 6s linear infinite}
.overgo .screen.epic .glow{opacity:1; animation:rot 4s linear infinite}
@keyframes rot{to{transform:rotate(360deg)}}
.overgo .x.animate{animation:pop .7s ease-out}
@keyframes pop{0%{transform:scale(.96);opacity:.2}40%{transform:scale(1.05);opacity:1}100%{transform:scale(1)}}
.overgo .bar{margin-top:10px; height:6px; border-radius:999px; border:1px solid var(--line); overflow:hidden; background:#0b132a}
.overgo .bar>div{height:100%; width:0; background:linear-gradient(90deg, var(--win), var(--win2)); transition:width .35s ease-out,background .2s ease-out}
.overgo .stripWrap{margin-top:10px; border:1px solid var(--line); border-radius:10px; padding:6px 8px; background:#0a1228}
.overgo .stripTitle{font-size:11px; letter-spacing:.12em; color:#6b7280; text-transform:uppercase; margin-bottom:4px}
.overgo .strip{display:flex; gap:6px; overflow-x:auto; padding-bottom:2px}
.overgo .chipx{flex:0 0 auto; border-radius:999px; padding:4px 10px; font-size:11px; font-weight:700; min-width:44px; text-align:center; box-shadow:0 4px 10px rgba(0,0,0,.35)}
.overgo .chipx.win{background:#166534; color:#dcfce7}
.overgo .chipx.lose{background:#7f1d1d; color:#fecaca}
.overgo .toast{position:absolute; left:50%; bottom:18px; transform:translateX(-50%) translateY(20px); padding:10px 18px; border-radius:999px; font-size:13px; font-weight:700; letter-spacing:.06em; display:flex; gap:8px; opacity:0; pointer-events:none; transition:.25s; box-shadow:0 16px 40px rgba(0,0,0,.7)}
.overgo .toast.show{opacity:1; transform:translateX(-50%) translateY(0)}
.overgo .toast.win{background:rgba(22,163,74,.14); border:1px solid rgba(34,197,94,.9); color:#dcfce7}
.overgo .toast.lose{background:rgba(220,38,38,.14); border:1px solid rgba(248,113,113,.9); color:#fecaca}
.overgo .particle{position:absolute; width:6px; height:6px; border-radius:50%; pointer-events:none; opacity:0; animation:fly .9s ease-out forwards}
@keyframes fly{0%{opacity:1;transform:translate(0,0) scale(1)}100%{opacity:0;transform:translate(var(--dx),var(--dy)) scale(.2)}}

/* ====== Crash iframe layout (–æ—Ç–¥–∞–ª–∏–ª–∏ –∏–≥—Ä—É) ====== */
.other-game-frame-wrap{
  position:relative;
  width:100%;
  max-width:900px;
  margin:0 auto;
  border-radius:18px;
  overflow:hidden;
  box-shadow:var(--shadow);
  background:#020617;
}
.other-game-frame-wrap::before{
  content:"";
  display:block;
  padding-top:60%; /* –≤—ã—Å–æ—Ç–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
}
.other-game-frame{
  position:absolute;
  top:0;
  left:50%;
  transform:translateX(-50%) scale(0.8); /* –æ—Ç–¥–∞–ª—è–µ–º */
  transform-origin:top center;
  width:130%;
  height:100%;
  border:0;
}
@media (min-width:720px){
  .other-game-frame-wrap::before{
    padding-top:56.25%;
  }
  .other-game-frame{
    left:0;
    transform:none;
    width:100%;
  }
}
</style>
</head>
<body>
  <div class="header">
    <div class="logo">‚ùÑÔ∏è</div>
    <div>
      <div class="title">Starify</div>
      <div class="subtitle">–º–∞–≥–∞–∑–∏–Ω ‚Ä¢ –º–∏–Ω–∏-–∏–≥—Ä—ã ‚Ä¢ —Ä–µ—Ñ–µ—Ä–∞–ª–∫–∞</div>
    </div>
    <div style="margin-left:auto" class="badge" id="userBadge">@guest</div>
  </div>

  <div class="page">
    <section class="container active" id="home">
      <div class="card">
        <h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Starify üé∞</h3>
        <div class="bigbtn" style="margin-top:8px">
          <button class="btn" data-tab-go="shop">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
          <button class="btn purple" data-tab-go="games">üé≤ –ò–≥—Ä—ã</button>
          <button class="btn ghost" data-tab-go="ref">ü§ù –†–µ—Ñ–µ—Ä–∞–ª–∫–∞</button>
        </div>
        <div class="banners" style="margin-top:12px">
          <a class="banner" id="banner1" href="https://t.me/starify777" target="_blank" rel="noopener" style="background-image:url('assets/photo1.jpg')">
            <div class="tag">–ù–∞—à Telegram-–∫–∞–Ω–∞–ª</div>
          </a>
          <a class="banner" id="banner2" href="https://t.me/starify7777" target="_blank" rel="noopener" style="background-image:url('assets/photo2.jpg')">
            <div class="tag">–ù–∞—à Telegram-—á–∞—Ç</div>
          </a>
        </div>
      </div>
    </section>

    <section class="container" id="shop">
      <div class="card">
        <h3>–ú–∞–≥–∞–∑–∏–Ω</h3>
        <p>–í—ã–±–µ—Ä–∏ –∑–≤—ë–∑–¥—ã –∏–ª–∏ Premium. –°—Ä–∞–∑—É –ø–µ—Ä–µ–π–¥—ë–º –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é.</p>
        <div class="hr"></div>
        <div class="grid cols-2" style="margin-top:6px">
          <div class="card" style="background:linear-gradient(180deg,rgba(56,189,248,.18),rgba(255,255,255,.04))">
            <h3>‚≠ê –ó–≤—ë–∑–¥—ã</h3>
            <div class="grid" id="starsQuick"></div>
            <div class="hr"></div>
            <div class="tile">
              <div style="flex:1">
                <div class="badge" style="margin-bottom:6px">–î—Ä—É–≥–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</div>
                <input id="customStars" class="input" type="number" min="1" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ">
              </div>
              <button class="btn purple" id="buyCustomStars">–£–∫–∞–∑–∞—Ç—å</button>
            </div>
          </div>
          <div class="card" style="background:linear-gradient(180deg,rgba(99,102,241,.2),rgba(255,255,255,.04))">
            <h3>üíé Premium</h3>
            <div class="grid" id="premiumPlans"></div>
          </div>
        </div>
      </div>
    </section>

    <section class="container" id="checkout">
      <div class="card">
        <h3>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h3>
        <p id="checkoutWhat">–í—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä</p>
        <div class="hr"></div>
        <div class="grid">
          <input id="username" class="input" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ @username –ø–æ–ª—É—á–∞—Ç–µ–ª—è">
          <input id="amount" class="input" type="number" min="1" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (–¥–ª—è –∑–≤—ë–∑–¥)">
          <button class="btn" id="proceed">–ü—Ä–∏–æ–±—Ä–µ—Å—Ç–∏</button>
          <button class="btn ghost" data-tab-go="shop">–ù–∞–∑–∞–¥ –≤ –º–∞–≥–∞–∑–∏–Ω</button>
        </div>
      </div>
    </section>

    <section class="container" id="games">
      <div class="card">
        <h3>–ú–∏–Ω–∏-–∏–≥—Ä—ã</h3>
        <div class="row" style="margin-top:6px">
          <span class="free-badge">üÜì –î–µ–º–æ-—Ä–µ–∂–∏–º: –±–∞–ª–∞–Ω—Å –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—Å—è</span>
        </div>
        <div class="games-grid" style="margin-top:8px">
          <button class="btn gbtn" data-game="slot">üé∞ –°–ª–æ—Ç</button>
          <button class="btn purple gbtn" data-game="cups">ü•§ –°—Ç–∞–∫–∞–Ω—ã</button>
          <button class="btn ghost gbtn" data-game="wheel">üß≠ –ö–æ–ª–µ—Å–æ</button>
          <button class="btn gbtn" data-game="other">üß™ –î—Ä—É–≥–∏–µ –∏–≥—Ä—ã</button>
        </div>
      </div>
      <div id="gameArea" class="grid" style="margin-top:6px"></div>
    </section>

    <section class="container" id="bonus">
      <div class="card">
        <h3>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å</h3>
        <p>–ó–∞—Ö–æ–¥–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –ø–æ–ª—É—á–∞–π <b>1 –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Ä—É—Ç</b> (–Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è). –°–µ—Ä–∏—è –∏–∑ 7 –¥–Ω–µ–π.</p>
        <div class="hr"></div>
        <div class="row" style="margin-top:8px">
          <div class="badge">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
          <button class="btn" id="dailyBtn">–ó–∞–±—Ä–∞—Ç—å</button>
        </div>
        <div class="bonus-bar" id="bonusBar" style="margin-bottom:6px"></div>
        <div class="tile"><div>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø—Ä–æ–∫—Ä—É—Ç–æ–≤</div><div><b data-free-counter>‚àû</b></div></div>
      </div>
    </section>

    <section class="container" id="ref">
      <div class="card">
        <h3>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h3>
        <p>–ü–æ–¥–µ–ª–∏—Å—å —Å—Å—ã–ª–∫–æ–π ‚Äî –¥—Ä—É–≥ –ø–æ–ª—É—á–∏—Ç –±–æ–Ω—É—Å, –∞ —Ç—ã –±–æ–Ω—É—Å –∑–≤—ë–∑–¥–∞–º–∏.</p>
        <div class="hr"></div>
        <div class="row" style="margin-top:8px">
          <input id="refLink" class="input" readonly value="https://t.me/your_bot_here?start=ref_0000">
          <button class="btn purple" id="copyRef">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
      </div>
    </section>

    <section class="container" id="profile">
      <div class="card">
        <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
        <p id="whoami">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ–¥—Ç—è–Ω–µ—Ç—Å—è –∏–∑ Telegram, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ.</p>
        <div class="hr"></div>
        <div class="grid">
          <div class="tile"><div>üéÆ –ò–≥—Ä–æ–≤–æ–π –±–∞–ª–∞–Ω—Å</div><div id="gameBal">0 ‚≠ê</div></div>
          <div class="tile"><div>ü§ù –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å</div><div id="refBal">0 ‚≠ê</div></div>
        </div>
        <div class="row" style="margin-top:8px">
          <button class="btn ghost" id="closeBtn">–ó–∞–∫—Ä—ã—Ç—å MiniApp</button>
        </div>
      </div>
    </section>
  </div>

  <nav class="nav">
    <button class="tab active" data-tab="home">üè†<span>–î–æ–º</span></button>
    <button class="tab" data-tab="shop">üõí<span>–ú–∞–≥–∞–∑–∏–Ω</span></button>
    <button class="tab" data-tab="games">üé≤<span>–ò–≥—Ä—ã</span></button>
    <button class="tab" data-tab="ref">ü§ù<span>–†–µ—Ñ–µ—Ä–∞–ª–∫–∞</span></button>
    <button class="tab" data-tab="bonus">üéÅ<span>–ë–æ–Ω—É—Å</span></button>
    <button class="tab" data-tab="profile">üë§<span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
  </nav>

  <div class="toast" id="toast">–ì–æ—Ç–æ–≤–æ!</div>

<script>
const tg = window.Telegram?.WebApp;
function applyTheme(){
  if(!tg) return;
  const t = tg.themeParams || {};
  document.documentElement.style.setProperty('--line', t.section_separator_color || 'rgba(255,255,255,.10)');
}
(function hydrateUser(){
  try{
    const user = tg?.initDataUnsafe?.user;
    if(user){
      document.getElementById('userBadge').textContent = user.username ? '@'+user.username : (user.first_name||'user');
      document.getElementById('whoami').textContent = `–¢—ã: ${user.first_name||''} ${user.last_name||''} ${user.username?'(@'+user.username+')':''}`;
      const link = `https://t.me/${tg?.initDataUnsafe?.receiver?.username || 'your_bot_here'}?start=ref_${user.id}`;
      document.getElementById('refLink').value = link;
    }
  }catch{}
})();

const getInt = k => parseInt(localStorage.getItem(k)||'0',10) || 0;
const setInt = (k,v) => localStorage.setItem(k, String(v));

// —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å 10–∫ ‚Äî –µ–¥–∏–Ω–æ–∂–¥—ã
if (localStorage.getItem('game_balance') === null) {
  setInt('game_balance', 10000);
}

// –¥–µ–º–æ-—Ñ–ª–∞–≥: –∏–≥—Ä—ã –±–µ—Å–ø–ª–∞—Ç–Ω—ã
const FREE_PLAY = true;

function refreshBalances(){
  document.getElementById('gameBal').textContent = `${getInt('game_balance')} ‚≠ê`;
  document.getElementById('refBal').textContent  = `${getInt('ref_balance')} ‚≠ê`;
}
function updateFreeBadge(){
  document.querySelectorAll('[data-free-counter]').forEach(el=>el.textContent= FREE_PLAY ? '‚àû' : (getInt('free_spins')||0));
}
refreshBalances(); updateFreeBadge();

const ymd = (d=new Date()) => d.toISOString().slice(0,10);
const ymdYesterday = () => {const d=new Date(); d.setDate(d.getDate()-1); return ymd(d);};
function renderBonus(){
  const bar=document.getElementById('bonusBar'); if(!bar) return;
  bar.innerHTML='';
  const streak=getInt('daily_streak');
  for(let i=0;i<7;i++){
    const d=document.createElement('div');
    d.className='bonus-day'+(i<streak?' on':''); d.textContent=i+1; bar.appendChild(d);
  }
  const btn=document.getElementById('dailyBtn');
  const last=localStorage.getItem('daily_last');
  if(last===ymd()){ btn.disabled=true; btn.textContent='–£–∂–µ –∑–∞–±—Ä–∞–Ω–æ'; }
  else { btn.disabled=false; btn.textContent='–ó–∞–±—Ä–∞—Ç—å'; }
}
renderBonus();
document.getElementById('dailyBtn').onclick=()=>{
  const last=localStorage.getItem('daily_last');
  let streak=getInt('daily_streak');
  if(last===ymd()){ toast('–£–∂–µ –∑–∞–±—Ä–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è'); return; }
  if(last===ymdYesterday()) streak=Math.min(7, streak+1); else streak=1;
  setInt('daily_streak', streak);
  localStorage.setItem('daily_last', ymd());
  setInt('free_spins', getInt('free_spins') + 1);
  updateFreeBadge(); renderBonus();
  toast('üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Ä—É—Ç –Ω–∞—á–∏—Å–ª–µ–Ω');
};

const toast=(m='–ì–æ—Ç–æ–≤–æ!')=>{
  const el=document.getElementById('toast');
  el.textContent=m; el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'),1200);
};
function openTab(id){
  if(anim.busy) return;
  document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active',t.dataset.tab===id));
  document.querySelectorAll('.container').forEach(s=>s.classList.toggle('active',s.id===id));
}
document.querySelectorAll('.tab, [data-tab-go]').forEach(b=>b.onclick=()=>openTab(b.dataset.tab||b.dataset.tabGo));

const starsQuick=[500,1000,2500,5000];
const plans=[{name:'3 –º–µ—Å—è—Ü–∞',plan:'3m'},{name:'6 –º–µ—Å—è—Ü–µ–≤',plan:'6m'},{name:'12 –º–µ—Å—è—Ü–µ–≤',plan:'12m'}];
document.getElementById('starsQuick').innerHTML = starsQuick.map(q=>`<div class="tile"><div>‚≠ê ${q.toLocaleString('ru-RU')}</div><button class="btn" data-buy-stars="${q}">–ö—É–ø–∏—Ç—å</button></div>`).join('');
document.getElementById('premiumPlans').innerHTML = plans.map(p=>`<div class="tile"><div>${p.name}</div><button class="btn purple" data-buy-premium="${p.plan}">–ü—Ä–∏–æ–±—Ä–µ—Å—Ç–∏</button></div>`).join('');
let checkoutState={};
function goCheckout(state){
  checkoutState=state;
  const what=document.getElementById('checkoutWhat'), amount=document.getElementById('amount');
  if(state.type==='stars'){
    what.textContent=`–ü–æ–∫—É–ø–∫–∞ –∑–≤—ë–∑–¥: ${state.qty? state.qty+' ‚≠ê' : '—É–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∏–∂–µ'}`;
    amount.value = state.qty || ''; amount.parentElement.style.display='';
  } else {
    what.textContent=`–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ Telegram Premium: ${state.plan}`;
    amount.value=''; amount.parentElement.style.display='none';
  }
  openTab('checkout'); document.getElementById('username').focus();
}
document.addEventListener('click',(e)=>{
  const s=e.target.closest('[data-buy-stars]'), p=e.target.closest('[data-buy-premium]');
  if(s){ goCheckout({type:'stars', qty:parseInt(s.dataset.buyStars,10)}); }
  if(p){ goCheckout({type:'premium', plan:p.dataset.buyPremium}); }
});
document.getElementById('buyCustomStars').onclick=()=>goCheckout({type:'stars', qty:parseInt(document.getElementById('customStars').value,10) || null});
document.getElementById('proceed').onclick=()=>{
  const u=(document.getElementById('username').value||'').trim();
  if(!/^@[a-zA-Z0-9_]{2,32}$/.test(u)){ toast('–í–≤–µ–¥–∏ @username'); return; }
  if(checkoutState.type==='stars'){
    const qty = parseInt(document.getElementById('amount').value||checkoutState.qty||0,10);
    if(!qty || qty<1){ toast('–£–∫–∞–∂–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤—ë–∑–¥'); return; }
    toast(`–ó–∞—è–≤–∫–∞: –ó–≤—ë–∑–¥—ã ‚Üí ${u} ‚Ä¢ ${qty} ‚≠ê`);
  }else if(checkoutState.type==='premium'){ toast(`–ó–∞—è–≤–∫–∞: Premium ‚Üí ${u} ‚Ä¢ ${checkoutState.plan}`); }
};

(function antiCopy(){
  document.addEventListener('contextmenu', e=>e.preventDefault(), {passive:false});
  document.addEventListener('copy', e=>{ e.preventDefault(); toast('–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ'); }, {passive:false});
  document.addEventListener('selectstart', e=>{ if(!e.target.matches('input, textarea')) e.preventDefault(); }, {passive:false});
})();

const gameArea=document.getElementById('gameArea');
const rint=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const anim={
  busy:false,
  async run(fn){
    if(this.busy) return; this.busy=true;
    document.querySelectorAll('[data-game], [data-action], .tab').forEach(b=>b.disabled=true);
    try{ await fn(); }finally{
      this.busy=false;
      document.querySelectorAll('[data-game], [data-action], .tab').forEach(b=>b.disabled=false);
    }
  }
};
function markGame(kind){
  document.querySelectorAll('.gbtn').forEach(b=>b.classList.toggle('active', b.dataset.game===kind));
}

/* FREE —Ä–µ–∂–∏–º ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ —Å–ø–∏—Å—ã–≤–∞–µ–º */
function consumeFreeSpinIfAny(){ return !!FREE_PLAY; }

/* ‚Äî‚Äî‚Äî SLOT ‚Äî‚Äî‚Äî */
function mountSlot(){
  markGame('slot');
  gameArea.innerHTML=`
    <div class="card">
      <div class="slot-wrap">
        <div class="simple-slot">
          <div class="reel"><div class="roller" id="sl_r1"></div></div>
          <div class="reel"><div class="roller" id="sl_r2"></div></div>
          <div class="reel"><div class="roller" id="sl_r3"></div></div>
        </div>
      </div>
      <div style="display:grid;place-items:center;margin-top:10px;">
        <button class="btn" id="spinBtn" data-action="spin">–ö—Ä—É—Ç–∏—Ç—å</button>
        <div class="free-badge" style="margin-top:6px">üÜì –î–µ–º–æ</div>
      </div>
      <span class="badge" id="slotOut" style="margin-top:6px;display:block;text-align:center;">–£–¥–∞—á–∏!</span>
    </div>`;
  const symbols=['‚≠ê','‚ùÑÔ∏è','üéÑ','‚òÉÔ∏è','üéÅ','7Ô∏è‚É£'], N=symbols.length;
  const itemH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--sym'));
  const rollers = ['sl_r1','sl_r2','sl_r3'].map(id=>{
    const el = document.getElementById(id);
    el.innerHTML = Array(30).fill(0).flatMap(()=>symbols).map(s=>`<div class="symbol">${s}</div>`).join('');
    return el;
  });
  const easeOutCubic = t => 1 - Math.pow(1 - t, 3);

  async function spin(){
    await anim.run(async()=>{
      document.getElementById('slotOut').textContent='–ö—Ä—É—Ç–∏–º...';
      const results = await Promise.all(rollers.map((r,i)=>new Promise(res=>{
        const k=rint(0, N-1), target=(rint(10,15)*N + ((k-1+N)%N)) * itemH;
        const t0=performance.now();
        const duration = 3000 + i * 200;
        const step=(now)=>{
          const elapsed = now - t0;
          const progress = Math.min(elapsed / duration, 1);
          const easedProgress = easeOutCubic(progress);
          r.style.transform=`translate3d(0,-${Math.round(easedProgress * target)}px,0)`;
          if(progress < 1) requestAnimationFrame(step); else res(k);
        };
        requestAnimationFrame(step);
      })));
      const [a,b,c] = results.map(i=>symbols[i]);
      document.getElementById('slotOut').textContent = (a===b && b===c) ? `–ü–æ–±–µ–¥–∞! ${a}${b}${c}` : `${a} | ${b} | ${c}`;
    });
  }
  document.getElementById('spinBtn').onclick=spin;
}

/* ‚Äî‚Äî‚Äî CUPS ‚Äî‚Äî‚Äî */
function mountCups(){
  markGame('cups');
  gameArea.innerHTML = `
    <div class="card">
      <div class="stage"></div>
      <div class="cups-ui">
        <button class="btn" data-action="mix">–ù–∞—á–∞—Ç—å</button>
        <span class="free-badge">üÜì –î–µ–º–æ</span>
      </div>
    </div>`;
  const stage = gameArea.querySelector('.stage');
  const ball = document.createElement('div'); ball.className='ball-sm'; stage.appendChild(ball);

  let cupColorClasses;
  try {
    cupColorClasses = JSON.parse(localStorage.getItem('cup_color_order'));
    if (!Array.isArray(cupColorClasses) || cupColorClasses.length !== 3) throw new Error();
  } catch { cupColorClasses = ['cup--color1', 'cup--color2', 'cup--color3']; }

  const cups = cupColorClasses.map(colorClass => {
    const c = document.createElement('div'); c.className = `cup ${colorClass}`; stage.appendChild(c); return c;
  });

  const baseY=150, upY=72, ballY=baseY+18;
  const posX=()=>(W=stage.clientWidth, C=W/2, G=Math.min(160, Math.max(110, (W-220)/2)), [C-G, C, C+G]);
  let cupsAtPos=[...cups], ballPosIndex=1;

  function shuffle(array){ for(let i=array.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [array[i],array[j]]=[array[j],array[i]]; } }
  function shuffleCupColors(){ shuffle(cupColorClasses); applyColors(); }
  function cycleCupColors(){ cupColorClasses.push(cupColorClasses.shift()); applyColors(); }
  function applyColors(){
    cupsAtPos.forEach((cup, i) => {
      cup.classList.remove('cup--color1', 'cup--color2', 'cup--color3');
      cup.classList.add(cupColorClasses[i]);
    });
  }

  function placeAll(raised){
    const xs=posX();
    cupsAtPos.forEach((cup,pos)=>{ cup.style.transform=`translate(${xs[pos]}px, ${raised?upY:baseY}px) translate(-50%,-50%)`; });
    ball.style.transform=`translate(${xs[ballPosIndex]}px, ${ballY}px) translate(-50%,-50%)`;
  }
  async function swapPos(a,b,ms=200){
    const xs=posX(); [cupsAtPos[a], cupsAtPos[b]]=[cupsAtPos[b], cupsAtPos[a]];
    cupsAtPos.forEach((cup,pos)=>{ cup.style.transition=`transform ${ms}ms ease`; cup.style.transform=`translate(${xs[pos]}px, ${baseY}px) translate(-50%,-50%)`; });
    if(ballPosIndex===a) ballPosIndex=b; else if(ballPosIndex===b) ballPosIndex=a;
    ball.style.transition=`transform ${ms}ms ease`; ball.style.transform=`translate(${xs[ballPosIndex]}px, ${ballY}px) translate(-50%,-50%)`;
    const rand = Math.random();
    if (rand < 0.35) { shuffleCupColors(); }
    else if (rand < 0.6) { cycleCupColors(); }
    await new Promise(r=>setTimeout(r,ms+18));
  }
  async function startRound(){
    await anim.run(async()=>{
      ballPosIndex=1; placeAll(true);
      const initialColorOrder = [...cupColorClasses];
      await new Promise(r=>setTimeout(r,500));
      const xs=posX();
      cupsAtPos.forEach((cup,pos)=>{ cup.style.transition='transform .2s ease'; cup.style.transform=`translate(${xs[pos]}px, ${baseY}px) translate(-50%,-50%)`; });
      await new Promise(r=>setTimeout(r,200)); ball.style.opacity='0';
      for(let i=0;i<rint(14,22);i++){ await swapPos(rint(0,1), rint(1,2), rint(300,450)); }
      if (Math.random() < 0.3) { cupColorClasses = initialColorOrder; applyColors(); await new Promise(r => setTimeout(r, 300)); }
      const guessPos = await new Promise(res=>cupsAtPos.forEach((cup,pos)=>{ cup.style.cursor='pointer'; cup.onclick=()=>res(pos); }));
      cupsAtPos.forEach(c=>{ c.onclick=null; c.style.cursor='default'; });
      ball.style.opacity='1';
      cupsAtPos.forEach((cup,pos)=>{ cup.style.transition='transform .2s ease'; cup.style.transform=`translate(${xs[pos]}px, ${upY}px) translate(-50%,-50%)`; });
      localStorage.setItem('cup_color_order', JSON.stringify(cupsAtPos.map(c=>c.classList[1])));

      await new Promise(r=>setTimeout(r,200));
      toast(guessPos===ballPosIndex ? '–í–µ—Ä–Ω–æ! üéâ (–¥–µ–º–æ)' : '–ú–∏–º–æ (–¥–µ–º–æ)');
    });
  }
  placeAll(true); gameArea.querySelector('[data-action="mix"]').onclick=startRound;
}

/* ‚Äî‚Äî‚Äî WHEEL ‚Äî‚Äî‚Äî */
function mountWheel() {
  markGame('wheel');
  gameArea.innerHTML = `
    <div class="card">
      <div class="stage">
        <div class="wheel-wrapper">
          <div class="wheel-pointer"></div>
          <div class="wheel-container">
            <svg class="wheel-svg" viewBox="0 0 200 200"></svg>
          </div>
          <div class="wheel-center"></div>
        </div>
      </div>
      <div style="display:grid; place-items:center;">
        <button class="btn" data-action="spinwheel" style="margin-top:10px;">–ö—Ä—É—Ç–∏—Ç—å</button>
        <div class="free-badge" style="margin-top:6px;">üÜì –î–µ–º–æ</div>
      </div>
    </div>`;
  const wheelSVG = gameArea.querySelector('.wheel-svg');
  let currentRotation = 0;
  const PRIZES = [
    { text: '+10 ‚≠ê', color: '#38bdf8' },
    { text: '+50 ‚≠ê', color: '#6366f1' },
    { text: '–ù–∏—á–µ–≥–æ', color: '#4b5563' },
    { text: '+100 ‚≠ê', color: '#22d3ee' },
    { text: 'x2', color: '#a5b4fc' },
    { text: '+25 ‚≠ê', color: '#38bdf8' },
    { text: '–ù–∏—á–µ–≥–æ', color: '#4b5563' },
    { text: '–î–∂–µ–∫–ø–æ—Ç', color: '#eab308' }
  ];
  const numSegments = PRIZES.length, angleStep = 360 / numSegments;
  const center = 100, radius = 100;
  function polarToCartesian(r, angle){
    const a=(angle-90)*Math.PI/180;
    return {x:center + r*Math.cos(a), y:center + r*Math.sin(a)};
  }
  wheelSVG.innerHTML='';
  PRIZES.forEach((p,i)=>{
    const sa=i*angleStep, ea=sa+angleStep, ma=sa+angleStep/2;
    const s=polarToCartesian(radius,ea), e=polarToCartesian(radius,sa);
    wheelSVG.innerHTML+=`
      <path d="M ${s.x} ${s.y} A ${radius} ${radius} 0 0 0 ${e.x} ${e.y} L ${center} ${center} Z"
            fill="${p.color}"
            stroke="rgba(15,23,42,.45)"
            stroke-width="1.5"></path>`;
    const tp=polarToCartesian(radius*0.6,ma);
    wheelSVG.innerHTML+=`
      <text x="${tp.x}" y="${tp.y}"
            transform="rotate(${ma}, ${tp.x}, ${tp.y})"
            text-anchor="middle"
            fill="#fff"
            font-size="12"
            font-weight="800">${p.text}</text>`;
    const le=polarToCartesian(radius,sa);
    wheelSVG.innerHTML+=`
      <line x1="${center}" y1="${center}" x2="${le.x}" y2="${le.y}"
            stroke="rgba(255,255,255,.25)"
            stroke-width="1.3"></line>`;
  });
  const easeInOutCubic=t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;

  async function spinWheel(){
    await anim.run(async ()=>{
      const targetIndex=rint(0,numSegments-1);
      const segCenter=targetIndex*angleStep+angleStep/2;
      const targetAngle=360-segCenter;
      const fullSpins=rint(6,10)*360;
      const start=((currentRotation%360)+360)%360;
      const angleDiff=((targetAngle-start+360)%360);
      const end=start+fullSpins+angleDiff;
      const dur=10000+rint(0,3000), t0=performance.now();
      await new Promise(res=>{
        function step(now){
          const p=Math.min(1,(now-t0)/dur), eased=easeInOutCubic(p);
          wheelSVG.style.transform=`rotate(${start+(end-start)*eased}deg)`;
          if(p<1) requestAnimationFrame(step); else { wheelSVG.style.transform=`rotate(${end}deg)`; res(); }
        }
        requestAnimationFrame(step);
      });
      currentRotation=end%360;
      toast(`–†–µ–∑—É–ª—å—Ç–∞—Ç (–¥–µ–º–æ): ${PRIZES[targetIndex].text}`);
    });
  }
  gameArea.querySelector('[data-action="spinwheel"]').onclick=spinWheel;
}

/* ===== –û–ö–ù–û "–î–†–£–ì–ò–ï –ò–ì–†–´" ===== */
function mountOtherGames(){
  markGame('other');
  gameArea.innerHTML = `
    <div class="card">
      <h3>–î—Ä—É–≥–∏–µ –∏–≥—Ä—ã</h3>
      <p>–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∂–∏–º—ã. –ë–∞–ª–∞–Ω—Å –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—Å—è ‚Äî –≤—Å—ë –≤ –¥–µ–º–æ.</p>
      <div class="banners" style="margin-top:10px">
        <div class="banner" style="background-image:url('assets/overgo-cover.jpg'); height:120px;">
          <div class="tag">üß™ Overgo ‚Ä¢ –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫</div>
        </div>
        <div class="banner" style="background-image:url('assets/star-crash-cover.jpg'); height:120px;">
          <div class="tag">‚≠ê Star Crash ‚Ä¢ –∫—Ä–∞—à</div>
        </div>
      </div>
      <div class="games-grid" style="margin-top:10px">
        <button class="btn gbtn" data-og="overgo">üß™ Overgo</button>
        <button class="btn purple gbtn" data-og="crash">‚≠ê Star Crash</button>
      </div>
      <button class="btn ghost" style="margin-top:10px" data-og="back-main">‚Üê –ù–∞–∑–∞–¥ –∫ –æ—Å–Ω–æ–≤–Ω—ã–º –∏–≥—Ä–∞–º</button>
    </div>`;
  const overgoBtn = gameArea.querySelector('[data-og="overgo"]');
  const crashBtn = gameArea.querySelector('[data-og="crash"]');
  const backBtn = gameArea.querySelector('[data-og="back-main"]');
  overgoBtn.onclick = () => mountOvergo();
  crashBtn.onclick = () => mountCrash();
  backBtn.onclick = () => showGame('slot');
}

/* ===== OVERGO (—Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏) ===== */
function mountOvergo(){
  markGame('other');
  gameArea.innerHTML = `
  <div class="card overgo">
    <div class="banner" style="background-image:url('assets/overgo-cover.jpg'); height:120px; margin-bottom:10px;">
      <div class="tag">üß™ Overgo ‚Ä¢ –¥–µ–º–æ</div>
    </div>
    <h3>Overgo</h3>
    <div class="grid">
      <div class="panel">
        <div class="title">–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏</div>
        <div class="field">
          <input type="number" id="og_bet" min="0" step="1" value="150" />
          <div class="badge">‚≠ê</div>
        </div>
        <div class="chips">
          <button class="chip" data-type="add" data-val="100">+100</button>
          <button class="chip" data-type="add" data-val="500">+500</button>
          <button class="chip" data-type="add" data-val="1000">+1k</button>
          <button class="chip" data-type="half">1/2</button>
          <button class="chip" data-type="double">x2</button>
          <button class="chip danger" data-type="clear">üóë</button>
        </div>
        <button class="btn btn-main" id="og_play" data-action="og_play">–ò–≥—Ä–∞—Ç—å</button>
        <div class="pills">
          <div class="pill">–ë–∞–ª–∞–Ω—Å <b><span id="og_bal">${FREE_PLAY?'‚àû':getInt('game_balance')}</span> ‚≠ê</b></div>
          <div class="pill">–ü–æ—Å–ª–µ–¥–Ω–∏–π <b id="og_last">x1.02</b></div>
        </div>
        <div class="free-badge" style="margin-top:8px">üÜì –î–µ–º–æ</div>
      </div>

      <div class="panel">
        <div class="statgrid">
          <div class="stat">
            <span>–¶–µ–ª—å</span>
            <div style="display:flex;align-items:center;gap:4px">
              <input type="text" id="og_target" placeholder="–Ω–∞–ø—Ä. 1.02" value="2.00" />
              <span style="font-size:13px;color:var(--muted)">x</span>
            </div>
          </div>
          <div class="stat">
            <span>–®–∞–Ω—Å</span>
            <div style="display:flex;align-items:center;gap:4px">
              <input type="text" id="og_chance" placeholder="–Ω–∞–ø—Ä. 35" value="35.0" />
              <span style="font-size:13px;color:var(--muted)">%</span>
            </div>
          </div>
          <div class="stat">
            <span>–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à</span>
            <div style="font-size:14px;color:var(--text);white-space:nowrap">
              <span id="og_payout">300.00</span> ‚≠ê
            </div>
          </div>
        </div>

        <div class="screen" id="og_screen">
          <div class="glow"></div>
          <div class="x win" id="og_x">x1.02</div>
          <div id="og_toast" class="toast win">
            <div id="og_toastLbl">WIN</div>
            <div id="og_toastMult">x2.00</div>
          </div>
        </div>

        <div class="bar"><div id="og_bar"></div></div>

        <div class="stripWrap">
          <div class="stripTitle">–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—É–Ω–¥–æ–≤</div>
          <div class="strip" id="og_strip"></div>
        </div>
      </div>
    </div>
  </div>`;

  const betEl = document.getElementById('og_bet');
  const targetEl = document.getElementById('og_target');
  const chanceEl = document.getElementById('og_chance');
  const playBtn = document.getElementById('og_play');
  const payoutEl = document.getElementById('og_payout');
  const xEl = document.getElementById('og_x');
  const screen = document.getElementById('og_screen');
  const toastEl = document.getElementById('og_toast');
  const toastLbl = document.getElementById('og_toastLbl');
  const toastMult = document.getElementById('og_toastMult');
  const bar = document.getElementById('og_bar');
  const lastEl = document.getElementById('og_last');
  const strip = document.getElementById('og_strip');

  const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));
  const cryptoRandom=()=>{const a=new Uint32Array(1); crypto.getRandomValues(a); return (a[0]+1)/4294967297;};

  const BASE_EDGE = 0.03;
  function generosity(target){
    return 1 - (target < 1.10 ? Math.min(.95, BASE_EDGE + 0.05) : BASE_EDGE);
  }
  function chanceFromTarget(t){
    const g=generosity(t); return clamp((g/t)*100,0.1,95);
  }
  function targetFromChance(c){
    const g=generosity(parseFloat(targetEl.value)||2); return clamp(g/(c/100),1.02,95000);
  }
  function sampleMultiplier(gen, target){
    const r = cryptoRandom();
    let m = gen / r;
    const hardCap = (target < 250) ? 250 : 95000;
    m = Math.max(1.02, Math.min(m, hardCap));
    return m;
  }
  function pushHistory(mult, win){
    const chip = document.createElement('div');
    chip.className = 'chipx ' + (win?'win':'lose');
    chip.textContent = mult.toFixed(2)+'x';
    strip.appendChild(chip);
    while (strip.children.length>40) strip.removeChild(strip.firstChild);
    strip.scrollLeft = strip.scrollWidth;
  }
  function particlesEpic(){
    for(let i=0;i<28;i++){
      const p=document.createElement('div'); p.className='particle';
      const a=(Math.random()*360)*Math.PI/180, dist=120+Math.random()*140;
      p.style.background=`hsl(${Math.floor(120+Math.random()*60)} 90% 60%)`;
      p.style.left='50%'; p.style.top='50%';
      p.style.setProperty('--dx', Math.cos(a)*dist+'px');
      p.style.setProperty('--dy', Math.sin(a)*dist+'px');
      screen.appendChild(p); setTimeout(()=>p.remove(),900);
    }
  }
  function showLoseStatic(val){
    screen.classList.remove('med','epic');
    xEl.className='x lose'; xEl.classList.remove('animate');
    xEl.textContent='x'+val.toFixed(2);
  }
  function animateWinValue(val){
    screen.classList.remove('med','epic');
    if (val>=20) screen.classList.add('epic'); else if (val>=5) screen.classList.add('med');
    xEl.className='x win'; xEl.classList.remove('animate'); void xEl.offsetWidth; xEl.classList.add('animate');
    const start=performance.now(), from=1.02, to=val, dur= val>=20?1200: (val>=5?900:700);
    requestAnimationFrame(function step(now){
      const t=Math.min(1,(now-start)/dur), e=1-Math.pow(1-t,3), cur=from+(to-from)*e;
      xEl.textContent='x'+cur.toFixed(2); if(t<1) requestAnimationFrame(step);
    });
    if(val>=20) particlesEpic();
  }
  function barFlash(win){
    const w = 70 + Math.random()*30;
    bar.style.background = win ? `linear-gradient(90deg,#22c55e,#86efac)` : `linear-gradient(90deg,#ef4444,#fca5a5)`;
    bar.style.width = w+'%';
    setTimeout(()=>bar.style.width='0%',650);
  }
  function showToast(win, m){
    toastEl.className='toast '+(win?'win':'lose');
    toastLbl.textContent = win ? 'WIN' : 'LOSE';
    toastMult.textContent = 'x'+m.toFixed(2);
    void toastEl.offsetWidth; toastEl.classList.add('show');
    setTimeout(()=>toastEl.classList.remove('show'),1400);
  }

  function updatePreview(){
    const bet = Math.floor(+betEl.value||0);
    let t = parseFloat((targetEl.value||'').replace(',','.'));
    let c = parseFloat((chanceEl.value||'').replace(',','.'));
    if(!isNaN(t)) {
      chanceEl.value = chanceFromTarget(t).toFixed(1);
      t = clamp(t,1.02,95000);
    } else if(!isNaN(c)) {
      t = targetFromChance(c);
      targetEl.value = t.toFixed(2);
    } else { t = 2; }
    payoutEl.textContent = (bet*t).toFixed(2);
  }
  targetEl.addEventListener('input',updatePreview);
  chanceEl.addEventListener('input',updatePreview);
  betEl.addEventListener('input',updatePreview);
  document.querySelectorAll('.chip').forEach(ch=>{
    ch.addEventListener('click',()=>{
      const t=ch.dataset.type, v=parseInt(ch.dataset.val||'0',10);
      let b = Math.floor(+betEl.value||0);
      if(t==='add') b+=v;
      else if(t==='double') b*=2;
      else if(t==='half') b=Math.floor(b/2);
      else if(t==='clear') b=0;
      betEl.value=b; updatePreview();
    });
  });
  updatePreview();

  async function play(){
    await anim.run(async ()=>{
      consumeFreeSpinIfAny();
      let t = clamp(parseFloat((targetEl.value||'').replace(',','.'))||2, 1.02, 95000);
      const g = generosity(t);
      chanceEl.value = ((g/t)*100).toFixed(1);
      let m = sampleMultiplier(g, t);
      const win = m >= t;
      if(win){ animateWinValue(m); }
      else { showLoseStatic(m); }
      showToast(win, m);
      barFlash(win);
      lastEl.textContent = 'x'+m.toFixed(2);
      pushHistory(m, win);
    });
  }
  playBtn.addEventListener('click', play);
}

/* ===== CRASH ===== */
function mountCrash(){
  markGame('other');
  gameArea.innerHTML = `
    <div class="card">
      <h3>‚≠ê Star Crash</h3>
      <p>–î–µ–º–æ-—Ä–µ–∂–∏–º: –±–∞–ª–∞–Ω—Å –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—Å—è.</p>
      <div class="other-game-frame-wrap" style="margin-top:8px;">
        <iframe src="crash-casino-final-v2.html" class="other-game-frame" loading="lazy"></iframe>
      </div>
      <button class="btn ghost" style="margin-top:10px" data-crash-back>‚Üê –ö –¥—Ä—É–≥–∏–º –∏–≥—Ä–∞–º</button>
    </div>`;
  gameArea.querySelector('[data-crash-back]').onclick = () => mountOtherGames();
}

/* Router */
function showGame(kind){
  if(anim.busy) return;
  const gameMounts = {
    slot: mountSlot,
    cups: mountCups,
    wheel: mountWheel,
    other: mountOtherGames
  };
  if(gameMounts[kind]) gameMounts[kind]();
}
document.querySelectorAll('[data-game]').forEach(b=>b.onclick=()=>showGame(b.dataset.game));
showGame('slot');

document.getElementById('copyRef').onclick=async()=>{
  try{ await navigator.clipboard.writeText(document.getElementById('refLink').value); toast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞'); }
  catch{ toast('–°–∫–æ–ø–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é'); }
};
document.getElementById('closeBtn').onclick=()=>tg?.close?.();

tg?.ready?.(); tg?.expand?.(); applyTheme();
</script>
</body>
</html>
