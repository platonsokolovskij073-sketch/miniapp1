<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TG MiniApp Deluxe</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root{
  --bg:#0f1221;
  --card:rgba(255,255,255,.08);
  --text:#fff;
  --muted:#b9c2d0;
  --accent:#6a8dff;
  --accent-2:#2fe0a1;
  --danger:#ff5c7a;
  --shadow:0 20px 50px rgba(0,0,0,.35);
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Inter',system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color:var(--text);
  background:
    radial-gradient(1200px 500px at 10% -10%, rgba(106,141,255,.25), transparent 70%),
    radial-gradient(900px 500px at 110% 10%, rgba(47,224,161,.2), transparent 70%),
    var(--bg);
  min-height:100svh;
  display:flex; flex-direction:column;
}

/* Top bar */
.header{
  position:sticky; top:0; z-index:10;
  backdrop-filter:saturate(140%) blur(14px);
  -webkit-backdrop-filter:saturate(140%) blur(14px);
  background:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.2));
  border-bottom:1px solid rgba(255,255,255,.06);
  padding:12px 16px;
  display:flex; align-items:center; gap:10px;
}
.logo{
  width:34px; height:34px; border-radius:12px;
  background:linear-gradient(135deg, var(--accent), #9a7bff);
  box-shadow:0 10px 30px rgba(106,141,255,.5);
  display:grid; place-items:center; font-weight:800;
}
.title{font-weight:800; letter-spacing:.3px}
.subtitle{font-size:12px; color:var(--muted)}

/* Content sections */
.container{padding:16px; flex:1; display:none; animation:fade .35s ease}
.container.active{display:block}
.grid{display:grid; gap:12px}
.grid.cards{grid-template-columns:repeat(2,minmax(0,1fr))}
.card{
  background:var(--card);
  border:1px solid rgba(255,255,255,.08);
  border-radius:20px; padding:14px;
  box-shadow:var(--shadow);
  transition:.25s transform, .25s box-shadow, .25s background;
}
.card:hover{transform:translateY(-2px)}
.card h3{margin:.2rem 0 .4rem; font-size:16px}
.card p{margin:0; font-size:12px; color:var(--muted)}
.price{font-weight:800; margin-top:6px}
.row{display:flex; align-items:center; justify-content:space-between; gap:10px}
.btn{
  appearance:none; border:0; cursor:pointer;
  padding:10px 14px; border-radius:14px;
  background:linear-gradient(135deg, var(--accent), #9a7bff);
  color:#fff; font-weight:700; box-shadow:0 8px 20px rgba(106,141,255,.35);
  transition:transform .15s ease, filter .2s ease;
}
.btn:active{transform:scale(.98)}
.btn.ghost{
  background:transparent; color:var(--text); border:1px solid rgba(255,255,255,.15)
}
.badge{
  background:rgba(255,255,255,.12);
  border:1px solid rgba(255,255,255,.2);
  padding:6px 8px; border-radius:10px; font-size:12px; color:var(--muted)
}

.kbd{
  font-size:11px; padding:4px 8px; border-radius:8px;
  border:1px solid rgba(255,255,255,.12); color:var(--muted)
}

/* Bottom nav */
.nav{
  position:sticky; bottom:0; z-index:10;
  display:grid; grid-template-columns:repeat(5,1fr);
  gap:8px; padding:10px;
  background:linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.55));
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-top:1px solid rgba(255,255,255,.06);
}
.tab{
  appearance:none; border:0; background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.08);
  color:#fff; padding:10px 8px; border-radius:14px; font-size:12px;
}
.tab.active{background:linear-gradient(135deg, rgba(255,255,255,.18), rgba(255,255,255,.08))}

/* Floating cart badge */
.fab{
  position:fixed; right:16px; bottom:76px; z-index:12;
  background:linear-gradient(135deg, var(--accent-2), #54ffd1);
  color:#003329; border:0; padding:14px 16px; border-radius:16px;
  box-shadow:0 12px 24px rgba(47,224,161,.4); font-weight:800;
  display:flex; gap:8px; align-items:center;
}
.fab .count{background:#003d2b; color:#b7ffea; padding:4px 8px; border-radius:10px; font-size:12px}

/* Toast */
.toast{
  position:fixed; left:50%; bottom:120px; transform:translateX(-50%) translateY(20px);
  background:rgba(0,0,0,.75); border:1px solid rgba(255,255,255,.15);
  color:#fff; padding:10px 14px; border-radius:12px; opacity:0; pointer-events:none;
  transition:opacity .2s ease, transform .2s ease; font-size:13px
}
.toast.show{opacity:1; transform:translateX(-50%) translateY(0)}

/* Mini game wheel */
.wheel-box{display:grid; place-items:center; gap:12px; margin-top:8px}
.wheel{
  width:220px; height:220px; border-radius:50%;
  background:
    conic-gradient(#fff0 0 10%, #ffffff15 0 20%,
                   #fff0 0 30%, #ffffff15 0 40%,
                   #fff0 0 50%, #ffffff15 0 60%,
                   #fff0 0 70%, #ffffff15 0 80%,
                   #fff0 0 90%, #ffffff15 0 100%),
    radial-gradient(closest-side, rgba(255,255,255,.08), rgba(255,255,255,.02));
  border:2px solid rgba(255,255,255,.2);
  position:relative; box-shadow:var(--shadow);
}
.pointer{
  width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-bottom:14px solid var(--accent);
  position:absolute; top:-8px; left:calc(50% - 10px); filter:drop-shadow(0 6px 8px rgba(0,0,0,.5))
}
.spin{padding:10px 16px; border-radius:12px; font-weight:800; border:0; cursor:pointer}
.spin[data-state="spin"]{background:linear-gradient(135deg, var(--accent), #9a7bff); color:#fff}
.spin[data-state="stop"]{background:linear-gradient(135deg, var(--danger), #ff8da1); color:#fff}

/* Fun emojirain */
.emoji{position:fixed; top:-40px; font-size:26px; animation:fall linear forwards}
@keyframes fall { to { transform:translateY(110vh) rotate(360deg); opacity:.9 } }

@keyframes fade { from {opacity:0; transform:translateY(6px)} to {opacity:1; transform:translateY(0)} }
.hidden{display:none}
hr.sep{border:0; height:1px; background:rgba(255,255,255,.08); margin:10px 0 0}
</style>
</head>
<body>

<!-- TOP -->
<div class="header">
  <div class="logo">‚òÖ</div>
  <div>
    <div class="title">MiniApp Deluxe</div>
    <div class="subtitle">–∫–Ω–æ–ø–∫–∏ ‚Ä¢ —ç—Ñ—Ñ–µ–∫—Ç—ã ‚Ä¢ –º–∏–Ω–∏-–∏–≥—Ä—ã ‚Ä¢ –∫–æ—Ä–∑–∏–Ω–∞</div>
  </div>
  <div style="margin-left:auto" class="badge" id="userBadge">guest</div>
</div>

<!-- HOME -->
<section class="container active" id="home">
  <div class="grid">
    <div class="card">
      <h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å üëã</h3>
      <p>–≠—Ç–æ —É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –∫—É—á–µ–π —Ñ–∏—à–µ–∫: –Ω–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è, –∫–æ—Ä–∑–∏–Ω–∞, –≤–∏–±—Ä–æ-—Ñ–∏–¥–±–µ–∫, –∫–æ–Ω—Ñ–µ—Ç—Ç–∏, –∏–≥—Ä—ã, ¬´–ø—Ä–∏–∫–æ–ª—ã¬ª –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞ –æ–±—Ä–∞—Ç–Ω–æ –±–æ—Ç—É.</p>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="confettiBtn">–ö–æ–Ω—Ñ–µ—Ç—Ç–∏!</button>
        <button class="btn ghost" id="themeBtn">–ü–æ–¥—Ö–≤–∞—Ç–∏—Ç—å —Ç–µ–º—É</button>
      </div>
      <div class="row" style="margin-top:8px">
        <span class="kbd">MainButton ‚Ä¢ BackButton ‚Ä¢ Haptics</span>
      </div>
    </div>

    <div class="card">
      <h3>–ú–∏–Ω–∏-–∏–≥—Ä—ã üé≤</h3>
      <p>–ö—Ä—É—Ç–∏–ª–∫–∞ —É–¥–∞—á–∏, –º–æ–Ω–µ—Ç–∫–∞, –∫—É–±–∏–∫. –ï—Å—Ç—å –ª—ë–≥–∫–∏–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –∏ –≤–∏–±—Ä–æ.</p>
      <div class="row" style="margin-top:8px">
        <button class="btn" data-open="games">–û—Ç–∫—Ä—ã—Ç—å –∏–≥—Ä—ã</button>
        <button class="btn ghost" id="coinBtn">–û—Ä–µ–ª/–†–µ—à–∫–∞</button>
      </div>
    </div>

    <div class="card">
      <h3>–ö–∞—Ç–∞–ª–æ–≥ üõç</h3>
      <p>–î–æ–±–∞–≤–ª—è–π —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É. –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ ‚Äî —á–µ—Ä–µ–∑ <b>MainButton</b>.</p>
      <div class="row" style="margin-top:8px">
        <button class="btn" data-open="shop">–ü–µ—Ä–µ–π—Ç–∏</button>
        <span class="badge">–ö–æ—Ä–∑–∏–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è</span>
      </div>
    </div>
  </div>
</section>

<!-- SHOP -->
<section class="container" id="shop">
  <div class="grid cards" id="catalog"></div>
  <hr class="sep">
  <div class="row" style="margin-top:12px">
    <div class="badge" id="totalBadge">–ò—Ç–æ–≥–æ: 0 ‚ÇΩ</div>
    <button class="btn ghost" id="clearCart">–û—á–∏—Å—Ç–∏—Ç—å</button>
  </div>
  <button class="fab hidden" id="cartFab">üß∫ –í –∫–æ—Ä–∑–∏–Ω–µ <span class="count" id="cartCount">0</span></button>
</section>

<!-- FUN -->
<section class="container" id="fun">
  <div class="grid">
    <div class="card">
      <h3>–≠–º–æ–¥–∂–∏-–¥–æ–∂–¥—å üåßÔ∏è</h3>
      <p>–ó–∞–ø—É—Å—Ç–∏ –ø–∞–¥–∞—é—â–∏–µ —ç–º–æ–¥–∑–∏ –Ω–∞ –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥.</p>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="emojiRain">–ü–æ–≥–Ω–∞–ª–∏</button>
        <span class="badge">–≤–µ—Å–µ–ª–æ üòÑ</span>
      </div>
    </div>

    <div class="card">
      <h3>–®—É—Ç–∫–∞ –¥–Ω—è üòπ</h3>
      <p id="joke">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —à—É—Ç–∫—É.</p>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="jokeBtn">–†–∞—Å–º–µ—à–∏ –º–µ–Ω—è</button>
        <span class="badge">–±–µ–∑ —Å–µ—Ä–≤–µ—Ä–æ–≤</span>
      </div>
    </div>
  </div>
</section>

<!-- GAMES -->
<section class="container" id="games">
  <div class="grid">
    <div class="card wheel-box">
      <div class="wheel" id="wheel"><div class="pointer"></div></div>
      <button class="spin" id="spinBtn" data-state="spin">–ö—Ä—É—Ç–∏—Ç—å –∫–æ–ª–µ—Å–æ</button>
      <div class="badge" id="wheelResult">–ø—Ä–∏–∑ —Å–∫—Ä—ã—Ç üéÅ</div>
    </div>

    <div class="card">
      <h3>–ö—É–±–∏–∫ üé≤</h3>
      <p id="diceOut">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –±—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫.</p>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="diceBtn">–ë—Ä–æ—Å–∏—Ç—å</button>
        <span class="badge">–µ—Å—Ç—å –≤–∏–±—Ä–æ</span>
      </div>
    </div>
  </div>
</section>

<!-- PROFILE -->
<section class="container" id="profile">
  <div class="grid">
    <div class="card">
      <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
      <p id="whoami">–ò–º—è –ø–æ–¥—Ç—è–Ω–µ—Ç—Å—è –∏–∑ Telegram (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ). –¢—É—Ç –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É.</p>
      <div class="row" style="margin-top:8px">
        <button class="btn" id="sendHello">–û—Ç–ø—Ä–∞–≤–∏—Ç—å ¬´–ü—Ä–∏–≤–µ—Ç¬ª –±–æ—Ç—É</button>
        <button class="btn ghost" id="closeBtn">–ó–∞–∫—Ä—ã—Ç—å MiniApp</button>
      </div>
    </div>
  </div>
</section>

<!-- NAV -->
<nav class="nav" id="nav">
  <button class="tab active" data-tab="home">üè† –î–æ–º</button>
  <button class="tab" data-tab="shop">üõç –ú–∞–≥–∞–∑–∏–Ω</button>
  <button class="tab" data-tab="fun">‚ú® –ü—Ä–∏–∫–æ–ª—ã</button>
  <button class="tab" data-tab="games">üéÆ –ò–≥—Ä—ã</button>
  <button class="tab" data-tab="profile">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
</nav>

<div class="toast" id="toast">–°–¥–µ–ª–∞–Ω–æ!</div>

<script>
const tg = window.Telegram?.WebApp;

// THEME ‚Üí CSS vars
function applyTheme(){
  if(!tg) return;
  const t = tg.themeParams || {};
  const set = (v, def)=> getComputedStyle(document.documentElement)
    .setProperty(v, t[v] || def);
  // Telegram theme variables loosely mapped
  document.documentElement.style.setProperty('--bg', t.bg_color || '#0f1221');
  document.documentElement.style.setProperty('--text', t.text_color || '#fff');
  document.documentElement
