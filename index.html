<!DOCTYPE html>
<html lang="ru" class="nocopy">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<meta name="color-scheme" content="dark light" />
<title>Starify ‚Äî MiniApp</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Courier+New:wght@700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0a12; --bg2:#161427; --text:#f7f4ff; --muted:#b7abc9;
  --line:rgba(255,255,255,.10); --card:rgba(255,255,255,.06);
  --orange:#38bdf8; --orange2:#a5f3fc;
  --violet:#6366f1; --violet2:#a5b4fc;
  --danger:#ff3b6b; --ok:#35ffb1; --shadow:0 20px 40px rgba(0,0,0,.35);
  --sym:56px; --cup-w: 92px; --cup-h: 86px;
}

html.nocopy, html.nocopy body, html.nocopy *:not(input):not(textarea){
  -webkit-user-select:none; user-select:none; -webkit-touch-callout:none;
}
html.nocopy ::selection{background:transparent}
html,body{height:100%; overflow:hidden;}
*{box-sizing:border-box}

body{
  margin:0; font-family:"Inter",system-ui,sans-serif; color:var(--text);
  background:radial-gradient(circle at top, #1e293b, #020617 55%);
  display:flex; flex-direction:column; overscroll-behavior:none;
}
.header{
  position:sticky; top:0; z-index:100; padding:14px 16px;
  display:flex; align-items:center; gap:12px;
  background:rgba(0,0,0,.55);
  backdrop-filter:blur(14px); border-bottom:1px solid var(--line);
}
.page{flex:1; display:flex; flex-direction:column; overflow-y:auto; overflow-x:hidden;}
.container{
  width:100%; max-width:920px; margin:0 auto;
  padding:14px 14px 90px; display:none; animation:fade .25s ease forwards;
}
.container.active{display:block}
.logo{
  width:36px; height:36px; border-radius:12px; display:grid; place-items:center; font-weight:800;
  background:conic-gradient(from 0deg, #e5f9ff, #38bdf8, #6366f1, #e5f9ff);
  color:#020617; box-shadow:var(--shadow);
}
.title{font-weight:800; letter-spacing:.3px}
.subtitle{font-size:12px; color:var(--muted)}
.grid{display:grid; gap:12px}
.grid.cols-2{grid-template-columns:1fr}
@media (min-width:560px){ .grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))} }
.card{
  background:var(--card); border:1px solid var(--line); border-radius:18px; padding:14px;
  box-shadow:var(--shadow); transition:.25s transform; position: relative;
}
.card h3{margin:.2rem 0 .4rem; font-size:16px}
.card p{margin:0; font-size:12px; color:var(--muted)}
.hr{height:1px; background:var(--line); margin:8px 0 2px}
.row{display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
.tile{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px; border-radius:14px; background:rgba(255,255,255,.06); border:1px solid var(--line)}
.input{
  width:100%; padding:12px 12px; border-radius:14px;
  border:1px solid var(--line); background:rgba(255,255,255,.06);
  color:var(--text); outline:none; font-family:inherit;
}
.input:focus{ border-color: rgba(56,189,248,.6); box-shadow:0 0 0 6px rgba(56,189,248,.18); }
.btn{
  appearance:none; border:0; cursor:pointer; padding:12px 14px; border-radius:14px; font-weight:800;
  color:#020617; background:linear-gradient(135deg, var(--orange), var(--orange2));
  box-shadow:0 12px 26px rgba(15,118,178,.45);
  transition:transform .12s,filter .2s, box-shadow .2s, opacity .2s;
}
.btn:active{transform:scale(.98)}
.btn:hover{ transform:translateY(-1px); box-shadow:0 16px 34px rgba(15,118,178,.6); }
.btn.purple{background:linear-gradient(135deg, var(--violet), var(--violet2)); color:#f9f5ff; box-shadow:0 12px 26px rgba(79,70,229,.45)}
.btn.purple:hover{ box-shadow:0 16px 34px rgba(79,70,229,.6); }
.btn.ghost{background:transparent; color:var(--text); border:1px solid var(--line); box-shadow:none}
.btn.danger{background:linear-gradient(135deg, #ef4444, #fca5a5); color:#fff; box-shadow:0 12px 26px rgba(239,68,68,.45)}
.btn.success{background:linear-gradient(135deg, #22c55e, #86efac); color:#022c22; box-shadow:0 12px 26px rgba(34,197,94,.45)}
.btn[disabled]{opacity:.5; pointer-events:none}
.badge{font-size:12px; padding:6px 8px; border-radius:10px; background:rgba(255,255,255,.10); border:1px solid var(--line); color:var(--muted)}
.bigbtn{display:flex; gap:12px}
.bigbtn .btn{flex:1; font-size:15px}
.nav{
  position:sticky; bottom:0; z-index:100; display:grid; grid-template-columns:repeat(6,1fr);
  gap:8px; padding:10px; background:rgba(0,0,0,.55);
  backdrop-filter:blur(12px); border-top:1px solid var(--line);
}
.tab{
  appearance:none; border:1px solid var(--line); background:rgba(255,255,255,.06); color:#fff;
  padding:12px 8px; border-radius:16px; font-size:12px; display:flex; flex-direction:column; align-items:center; gap:4px
}
.tab span{opacity:.85; font-size:11px}
.tab.active{background:linear-gradient(135deg, rgba(56,189,248,.22), rgba(99,102,241,.22)); border-color:rgba(56,189,248,.4)}
.gbtn{position:relative}
.gbtn.active{outline:2px solid #38bdf8; box-shadow:0 0 0 6px rgba(56,189,248,.25)}
.stage{
  position:relative; height:260px; border-radius:16px; background:rgba(255,255,255,.05);
  border:1px solid var(--line); overflow:hidden; touch-action:none;
}
.banners{display:grid; gap:12px}
@media(min-width:560px){ .banners{grid-template-columns:1fr 1fr} }
.banner{
  position:relative; border-radius:16px; overflow:hidden; border:1px solid var(--line);
  background-size:cover; background-position:center; height:140px;
  display:grid; place-items:center; color:#fff; box-shadow:var(--shadow)
}
.banner .tag{position:absolute; left:12px; top:12px; padding:6px 8px; border-radius:10px; background:rgba(0,0,0,.5); border:1px solid var(--line); font-size:12px}
.slot-wrap{display:grid; place-items:center; gap:10px}
.simple-slot{
  position:relative; width:310px; border-radius:16px; overflow:hidden;
  background:radial-gradient(circle at top, #1d3557, #020617);
  border:1px solid var(--line); box-shadow:var(--shadow);
  display:grid; grid-template-columns:repeat(3,1fr); gap:8px; padding:8px;
  height: calc(var(--sym)*3 + 16px);
}
.reel{position:relative; overflow:hidden; border-radius:12px; border:1px solid var(--line); background:linear-gradient(180deg, rgba(148,210,255,.18),rgba(15,23,42,1)); height:calc(var(--sym)*3)}
.roller{position:absolute; left:0; right:0; top:0; will-change:transform}
.symbol{height:var(--sym); display:grid; place-items:center; font-size:42px; line-height:1}

/* ‚Äî‚Äî‚Äî CUPS ‚Äî‚Äî‚Äî */
.cups-ui{display:flex; gap:10px; margin-top:8px}
.cup{position:absolute; width:var(--cup-w); height:var(--cup-h); will-change:transform; z-index:2; transition:transform .22s ease; border-radius:24px; transform-style:preserve-3d}
.cup::before{
  content:""; position:absolute; inset:4px 10px 8px;
  background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(148,210,255,.7));
  border:1px solid rgba(15,23,42,.4);
  box-shadow: inset 0 10px 18px rgba(255,255,255,.3), inset 0 -12px 22px rgba(15,23,42,.45);
  border-radius: 28px / 22px;
  clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%);
  background-color: #dbeafe;
  transition: background-color 0.3s ease;
}
.cup.cup--color1::before { background-color: #bfdbfe; }
.cup.cup--color2::before { background-color: #e0f2fe; }
.cup.cup--color3::before { background-color: #c7d2fe; }
.cup::after{
  content:""; position:absolute; left:50%; transform:translateX(-50%);
  width:78%; height:8px; bottom:4px; border-radius:50%;
  background:radial-gradient(closest-side, rgba(0,0,0,.35), transparent 70%);
}
.ball-sm{
  position:absolute; width:24px; height:24px; border-radius:50%;
  background:radial-gradient(circle at 30% 30%, #fbbf24, #f97316);
  box-shadow:0 8px 14px rgba(0,0,0,.35), inset 0 2px 4px rgba(255,255,255,.45);
  will-change:transform; z-index:1; transition:transform .22s ease, opacity .12s ease;
}

/* ‚Äî‚Äî‚Äî WHEEL ‚Äî‚Äî‚Äî */
.wheel-wrapper{position:relative; width: 240px; height: 240px; margin: auto; margin-top:10px; display:grid; place-items:center;}
.wheel-pointer{
  position:absolute; top: -2px; left: 50%; transform: translateX(-50%);
  width: 24px; height: 8px; border-radius: 4px;
  background-color: #38bdf8;
  box-shadow: 0 0 10px #38bdf8, 0 0 20px #38bdf8; z-index: 10;
}
.wheel-container{
  position:absolute; width:100%; height:100%; border-radius:50%;
  box-shadow: inset 0 0 20px rgba(0,0,0,.6), 0 0 0 6px #1f2933; border: 1px solid #1f2933;
  background: radial-gradient(circle at 30% 20%, rgba(56,189,248,.25), transparent 55%),
              radial-gradient(circle at 70% 80%, rgba(129,140,248,.25), transparent 55%),
              rgba(15,23,42,.85);
}
.wheel-container::before{content:""; position:absolute; inset:12px; border-radius:50%; border:1px dashed rgba(255,255,255,.18); box-shadow:0 0 18px rgba(0,0,0,.6);}
.wheel-svg{width:100%; height:100%; transform-origin:center;}
.wheel-center{
  position:absolute; width: 56px; height: 56px; border-radius: 50%;
  background: radial-gradient(circle, #4f46e5, #111827);
  border: 2px solid rgba(255,255,255,.4);
  box-shadow: 0 0 18px rgba(0,0,0,.8), 0 0 18px rgba(56,189,248,.45);
}
.wheel-center::after{content:"SPIN"; position:absolute; inset:0; display:grid; place-items:center; font-size:11px; letter-spacing:.16em; color:#e5f9ff; text-transform:uppercase;}

/* ‚Äî‚Äî‚Äî GAMES GRID & UI ‚Äî‚Äî‚Äî */
.games-grid{display:grid; gap:10px; grid-template-columns:1fr 1fr}
.games-grid .span2{ grid-column: 1 / span 2; display:flex; justify-content:center }
.games-grid .span2 .btn{ min-width:180px }
.free-badge{font-size:12px; padding:6px 8px; border-radius:10px; background:rgba(255,255,255,.10); border:1px solid var(--line); color:#ffe082}
.bonus-bar{display:grid; grid-template-columns:repeat(7,1fr); gap:8px; margin-top:8px}
.bonus-day{height:28px; border-radius:12px; border:1px solid var(--line); display:grid; place-items:center; font-size:12px; color:#fff9; background:rgba(255,255,255,.04)}
.bonus-day.on{ background:linear-gradient(135deg, rgba(56,189,248,.35), rgba(99,102,241,.35)); color:#e5f9ff; font-weight:800 }
.toast{position:fixed; left:50%; bottom:120px; transform:translateX(-50%) translateY(20px); background:rgba(0,0,0,.8); z-index:200;
  border:1px solid var(--line); color:#fff; padding:10px 14px; border-radius:12px; opacity:0; pointer-events:none; transition:opacity .2s, transform .2s; font-size:13px}
.toast.show{opacity:1; transform:translateX(-50%) translateY(0)}
@keyframes fade{from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:translateY(0)}

/* ===== OVERGO ===== */
.overgo .grid{display:grid; gap:12px}
.overgo .chips{display:flex; flex-wrap:wrap; gap:6px; margin-top:8px}
.overgo .chip{border:1px solid var(--line); background:#0a1228; color:#d1d5db; font-size:11px; border-radius:999px; padding:6px 10px; cursor:pointer; transition:.12s}
.overgo .chip:hover{transform:translateY(-1px); box-shadow:0 6px 16px rgba(34,197,94,.35); border-color:rgba(34,197,94,.5)}
.overgo .screen{position:relative; margin-top:10px; border:1px solid var(--line); border-radius:14px; background:radial-gradient(circle at top, rgba(34,197,94,.18), rgba(7,16,38,1)); min-height:240px; display:grid; place-items:center; overflow:hidden}
.overgo .x{position:relative; z-index:1; font-weight:800; letter-spacing:.06em; font-size:clamp(44px,6.5vw,72px); transform-origin:center}
.overgo .x.win{color:#dcfce7; text-shadow:0 0 14px rgba(34,197,94,.55),0 0 40px rgba(34,197,94,.65)}
.overgo .x.lose{color:#fecaca; text-shadow:0 0 14px rgba(239,68,68,.45),0 0 40px rgba(239,68,68,.40)}
.overgo .x.animate{animation:pop .7s ease-out}
@keyframes pop{0%{transform:scale(.96);opacity:.2}40%{transform:scale(1.05);opacity:1}100%{transform:scale(1)}}

/* ===== STAR CRASH UI ===== */
.crash-game { display:flex; flex-direction:column; gap:12px; }
.crash-stage {
  position: relative; width: 100%; height: 280px;
  background: linear-gradient(180deg, #0f1419 0%, #1a1f2e 100%);
  border-radius: 16px; overflow: hidden;
  border: 1px solid var(--line); box-shadow: var(--shadow);
}
.crash-canvas { display: block; width: 100%; height: 100%; }
.crash-overlay {
  position: absolute; top: 20px; left: 0; width: 100%;
  display: flex; flex-direction: column; align-items: center; pointer-events: none;
}
.crash-mult {
  font-family: 'Courier New', monospace;
  font-size: 48px; font-weight: 800;
  background: linear-gradient(45deg, #ffd700, #fff9c4);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  text-shadow: 0 0 20px rgba(255,215,0,0.3);
}
.crash-mult.crashed {
  background: linear-gradient(45deg, #ff4444, #ff9999);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  text-shadow: 0 0 20px rgba(255,68,68,0.3);
}
.crash-status { font-size: 12px; margin-top: 4px; color: var(--muted); background: rgba(0,0,0,0.5); padding: 4px 8px; border-radius: 8px; }
.crash-history-strip {
  display: flex; gap: 6px; padding: 8px;
  background: rgba(0,0,0,0.3); border-radius: 12px; border: 1px solid var(--line);
  overflow-x: auto; white-space: nowrap; margin-bottom: 6px;
}
.c-hist-item {
  font-size: 11px; padding: 4px 8px; border-radius: 6px; font-weight: 700; flex-shrink: 0;
  border: 1px solid transparent;
}
.c-hist-item.low { background: rgba(255,68,68,0.15); color: #fecaca; border-color: rgba(255,68,68,0.3); }
.c-hist-item.med { background: rgba(56,189,248,0.15); color: #e0f2fe; border-color: rgba(56,189,248,0.3); }
.c-hist-item.high { background: rgba(34,197,94,0.15); color: #dcfce7; border-color: rgba(34,197,94,0.3); }
.c-hist-item.mega { background: rgba(168,85,247,0.15); color: #f3e8ff; border-color: rgba(168,85,247,0.3); box-shadow: 0 0 8px rgba(168,85,247,0.2); }

.crash-controls { display: grid; gap: 10px; }
.auto-row { display: flex; align-items: center; justify-content: space-between; font-size: 13px; color: var(--muted); }
.toggle-switch {
  width: 40px; height: 22px; background: rgba(255,255,255,0.1); border-radius: 20px; position: relative; cursor: pointer; transition: .2s;
}
.toggle-switch.active { background: #6366f1; }
.toggle-knob {
  width: 18px; height: 18px; background: #fff; border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: .2s;
}
.toggle-switch.active .toggle-knob { left: 20px; }
</style>
</head>
<body>
  <div class="header">
    <div class="logo">‚ùÑÔ∏è</div>
    <div>
      <div class="title">Starify</div>
      <div class="subtitle">–º–∞–≥–∞–∑–∏–Ω ‚Ä¢ –º–∏–Ω–∏-–∏–≥—Ä—ã ‚Ä¢ —Ä–µ—Ñ–µ—Ä–∞–ª–∫–∞</div>
    </div>
    <div style="margin-left:auto" class="badge" id="userBadge">@guest</div>
  </div>

  <div class="page">
    <!-- HOME -->
    <section class="container active" id="home">
      <div class="card">
        <h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Starify üé∞</h3>
        <div class="bigbtn" style="margin-top:8px">
          <button class="btn" data-tab-go="shop">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
          <button class="btn purple" data-tab-go="games">üé≤ –ò–≥—Ä—ã</button>
          <button class="btn ghost" data-tab-go="ref">ü§ù –†–µ—Ñ–µ—Ä–∞–ª–∫–∞</button>
        </div>
        <div class="banners" style="margin-top:12px">
          <a class="banner" style="background-image:linear-gradient(45deg, #1e293b, #0f172a)">
            <div class="tag">–ù–∞—à Telegram-–∫–∞–Ω–∞–ª</div>
          </a>
        </div>
      </div>
    </section>

    <!-- SHOP -->
    <section class="container" id="shop">
      <div class="card">
        <h3>–ú–∞–≥–∞–∑–∏–Ω</h3>
        <p>–í—ã–±–µ—Ä–∏ –∑–≤—ë–∑–¥—ã –∏–ª–∏ Premium.</p>
        <div class="hr"></div>
        <div class="grid cols-2" style="margin-top:6px">
          <div class="card">
            <h3>‚≠ê –ó–≤—ë–∑–¥—ã</h3>
            <div class="grid" id="starsQuick"></div>
          </div>
          <div class="card">
            <h3>üíé Premium</h3>
            <div class="grid" id="premiumPlans"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- CHECKOUT -->
    <section class="container" id="checkout">
      <div class="card">
        <h3>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h3>
        <p id="checkoutWhat">–¢–æ–≤–∞—Ä</p>
        <div class="hr"></div>
        <div class="grid">
          <input id="username" class="input" type="text" placeholder="@username">
          <button class="btn" id="proceed">–ü—Ä–∏–æ–±—Ä–µ—Å—Ç–∏</button>
          <button class="btn ghost" data-tab-go="shop">–ù–∞–∑–∞–¥</button>
        </div>
      </div>
    </section>

    <!-- GAMES -->
    <section class="container" id="games">
      <div class="card">
        <h3>–ú–∏–Ω–∏-–∏–≥—Ä—ã</h3>
        <div class="row" style="margin-top:6px">
          <div class="tile" style="padding:6px 10px"><div style="font-size:12px">–ë–∞–ª–∞–Ω—Å: <b id="gameBalDisplay">0</b> ‚≠ê</div></div>
        </div>
        <div class="games-grid" style="margin-top:8px">
          <button class="btn gbtn" data-game="slot">üé∞ –°–ª–æ—Ç</button>
          <button class="btn purple gbtn" data-game="cups">ü•§ –°—Ç–∞–∫–∞–Ω—ã</button>
          <button class="btn ghost gbtn" data-game="wheel">üß≠ –ö–æ–ª–µ—Å–æ</button>
          <button class="btn gbtn" data-game="other">üß™ –î—Ä—É–≥–∏–µ</button>
        </div>
      </div>
      <div id="gameArea" class="grid" style="margin-top:6px"></div>
    </section>

    <!-- BONUS -->
    <section class="container" id="bonus">
      <div class="card">
        <h3>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å</h3>
        <p>–ó–∞—Ö–æ–¥–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –ø–æ–ª—É—á–∞–π +100 ‚≠ê</p>
        <div class="hr"></div>
        <button class="btn" id="dailyBtn" style="margin-top:10px;width:100%">–ó–∞–±—Ä–∞—Ç—å</button>
        <div class="bonus-bar" id="bonusBar" style="margin-top:12px"></div>
      </div>
    </section>

    <!-- REF -->
    <section class="container" id="ref">
      <div class="card">
        <h3>–†–µ—Ñ–µ—Ä–∞–ª–∫–∞</h3>
        <p>–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π –±–æ–Ω—É—Å—ã.</p>
        <div class="hr"></div>
        <div class="row" style="margin-top:8px">
          <input id="refLink" class="input" readonly value="https://t.me/bot?start=ref">
          <button class="btn purple" id="copyRef">–ö–æ–ø–∏—è</button>
        </div>
      </div>
    </section>

    <!-- PROFILE -->
    <section class="container" id="profile">
      <div class="card">
        <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
        <p id="whoami">–ì–æ—Å—Ç—å</p>
        <div class="hr"></div>
        <div class="grid">
          <div class="tile"><div>üéÆ –ë–∞–ª–∞–Ω—Å</div><div id="gameBal">0 ‚≠ê</div></div>
        </div>
        <button class="btn ghost" id="closeBtn" style="margin-top:10px;width:100%">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </section>
  </div>

  <nav class="nav">
    <button class="tab active" data-tab="home">üè†<span>–î–æ–º</span></button>
    <button class="tab" data-tab="shop">üõí<span>–ú–∞–≥–∞–∑–∏–Ω</span></button>
    <button class="tab" data-tab="games">üé≤<span>–ò–≥—Ä—ã</span></button>
    <button class="tab" data-tab="bonus">üéÅ<span>–ë–æ–Ω—É—Å</span></button>
    <button class="tab" data-tab="profile">üë§<span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
  </nav>

  <div class="toast" id="toast">–ì–æ—Ç–æ–≤–æ!</div>

<script>
/* --- SYSTEM & UTILS --- */
const tg = window.Telegram?.WebApp;
tg?.ready?.(); tg?.expand?.();

const getInt = k => parseInt(localStorage.getItem(k)||'0',10) || 0;
const setInt = (k,v) => localStorage.setItem(k, String(v));
if(localStorage.getItem('game_balance')===null) setInt('game_balance', 10000);

function refreshBalances(){
  const b = getInt('game_balance');
  document.getElementById('gameBal').textContent = `${b} ‚≠ê`;
  const d = document.getElementById('gameBalDisplay');
  if(d) d.textContent = b;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º UI –≤ Crash –∏–≥—Ä–µ, –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞
  const cBal = document.getElementById('c_balance');
  if(cBal) cBal.textContent = b + ' ‚≠ê';
}
refreshBalances();

const toast=(m)=>{
  const el=document.getElementById('toast');
  el.textContent=m; el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'),1500);
};

/* --- TABS --- */
function openTab(id){
  if(anim.busy) return;
  // –ï—Å–ª–∏ —É—Ö–æ–¥–∏–º —Å –≤–∫–ª–∞–¥–∫–∏ –∏–≥—Ä, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Crash
  if(id !== 'games' && crashGameApp.active) crashGameApp.stop();
  
  document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active',t.dataset.tab===id));
  document.querySelectorAll('.container').forEach(s=>s.classList.toggle('active',s.id===id));
}
document.querySelectorAll('.tab, [data-tab-go]').forEach(b=>b.onclick=()=>openTab(b.dataset.tab||b.dataset.tabGo));

/* --- SHOP & BONUS --- */
document.getElementById('starsQuick').innerHTML = [500,1000,5000].map(q=>`<div class="tile"><div>${q}‚≠ê</div><button class="btn" onclick="toast('–ü–æ–∫—É–ø–∫–∞ ${q}...')">–ö—É–ø–∏—Ç—å</button></div>`).join('');
document.getElementById('premiumPlans').innerHTML = ['3 –º–µ—Å','6 –º–µ—Å'].map(p=>`<div class="tile"><div>${p}</div><button class="btn purple" onclick="toast('Premium ${p}...')">–ö—É–ø–∏—Ç—å</button></div>`).join('');

const ymd = ()=>new Date().toISOString().slice(0,10);
function renderBonus(){
  const bar=document.getElementById('bonusBar'); bar.innerHTML='';
  const streak=getInt('daily_streak');
  for(let i=0;i<7;i++){
    const d=document.createElement('div'); d.className='bonus-day'+(i<streak?' on':''); d.textContent=i+1; bar.appendChild(d);
  }
}
renderBonus();
document.getElementById('dailyBtn').onclick=()=>{
  const last=localStorage.getItem('daily_last');
  if(last===ymd()){ toast('–£–∂–µ –∑–∞–±—Ä–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è'); return; }
  setInt('daily_streak', Math.min(7, getInt('daily_streak')+1));
  localStorage.setItem('daily_last', ymd());
  setInt('game_balance', getInt('game_balance')+100);
  refreshBalances(); renderBonus(); toast('+100 ‚≠ê –ø–æ–ª—É—á–µ–Ω–æ!');
};

/* --- GAMES ROUTER --- */
const gameArea=document.getElementById('gameArea');
const anim={busy:false, async run(fn){if(this.busy)return;this.busy=true;try{await fn()}finally{this.busy=false}}};
function markGame(kind){ document.querySelectorAll('.gbtn').forEach(b=>b.classList.toggle('active', b.dataset.game===kind)); }

document.querySelectorAll('[data-game]').forEach(b=>{
  b.onclick=()=>{
    if(anim.busy) return;
    if(crashGameApp.active) crashGameApp.stop(); // Stop crash if running
    showGame(b.dataset.game);
  }
});

function showGame(kind){
  if(kind==='slot') mountSlot();
  else if(kind==='cups') mountCups();
  else if(kind==='wheel') mountWheel();
  else if(kind==='other') mountOther();
}

/* --- SLOT --- */
function mountSlot(){
  markGame('slot');
  gameArea.innerHTML=`
    <div class="card">
      <div class="slot-wrap"><div class="simple-slot">
        <div class="reel"><div class="roller" id="sl_r1"></div></div>
        <div class="reel"><div class="roller" id="sl_r2"></div></div>
        <div class="reel"><div class="roller" id="sl_r3"></div></div>
      </div></div>
      <button class="btn" id="spinBtn" style="width:100%;margin-top:12px">–ö—Ä—É—Ç–∏—Ç—å (–ë–µ—Å–ø–ª–∞—Ç–Ω–æ)</button>
    </div>`;
  const s=['‚≠ê','‚ùÑÔ∏è','üçí','7Ô∏è‚É£','üíé'], H=56;
  ['sl_r1','sl_r2','sl_r3'].forEach(id=>{
    document.getElementById(id).innerHTML=Array(20).fill(0).map(()=>`<div class="symbol">${s[Math.floor(Math.random()*s.length)]}</div>`).join('');
  });
  document.getElementById('spinBtn').onclick=()=>anim.run(async()=>{
    const rollers=['sl_r1','sl_r2','sl_r3'].map(id=>document.getElementById(id));
    await Promise.all(rollers.map((r,i)=>new Promise(res=>{
      r.style.transition=`transform ${1+i*0.5}s cubic-bezier(.4,0,.2,1)`;
      r.style.transform=`translateY(-${Math.floor(Math.random()*10)*H}px)`;
      setTimeout(res, (1+i*0.5)*1000);
    })));
    toast('–ü—Ä–æ–∫—Ä—É—á–µ–Ω–æ!');
    rollers.forEach(r=>{ r.style.transition='none'; r.style.transform='none'; });
  });
}

/* --- CUPS --- */
function mountCups(){
  markGame('cups');
  gameArea.innerHTML=`<div class="card"><div class="stage" style="height:180px;display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--muted)">–°—Ç–∞–∫–∞–Ω—ã (–¥–µ–º–æ)</div></div>`;
}
/* --- WHEEL --- */
function mountWheel(){
  markGame('wheel');
  gameArea.innerHTML=`<div class="card"><div class="wheel-wrapper"><div class="wheel-container"></div></div><button class="btn" style="width:100%;margin-top:10px" onclick="toast('–ö—Ä—É—Ç–∏–º...')">–ö—Ä—É—Ç–∏—Ç—å</button></div>`;
}

/* --- OTHER GAMES MENU --- */
function mountOther(){
  markGame('other');
  gameArea.innerHTML=`
    <div class="card">
      <h3>–î—Ä—É–≥–∏–µ –∏–≥—Ä—ã</h3>
      <div class="grid">
        <button class="btn purple" onclick="mountCrash()">üöÄ Star Crash</button>
        <button class="btn ghost" onclick="mountOvergo()">üß™ Overgo (Demo)</button>
      </div>
    </div>`;
}

function mountOvergo(){
  gameArea.innerHTML=`<div class="card"><h3>Overgo</h3><p>–¢—É—Ç –º–æ–≥–ª–∞ –±—ã—Ç—å –≤–∞—à–∞ –∏–≥—Ä–∞ Overgo.</p><button class="btn ghost" onclick="mountOther()">–ù–∞–∑–∞–¥</button></div>`;
}

/* ==========================================
   üöÄ STAR CRASH GAME ENGINE (INTEGRATED)
   ========================================== */
let crashGameApp = {
  active: false,
  phase: 'betting', // betting, flying, crashed
  multiplier: 1.00,
  timer: 5.0,
  crashPoint: 2.0,
  bet: null, // {amount, cashedOut, profit}
  history: [1.45, 2.10, 5.55, 1.05, 3.20],
  stars: [],
  rafId: null,
  
  // DOM Elements
  els: {},

  init(container){
    this.active = true;
    this.phase = 'betting';
    this.multiplier = 1.00;
    this.timer = 5.0;
    this.bet = null;
    
    container.innerHTML = `
      <div class="card crash-game">
        <div class="row">
          <h3 style="margin:0">‚≠ê Star Crash</h3>
          <div class="badge" id="c_balance">${getInt('game_balance')} ‚≠ê</div>
        </div>

        <div class="crash-history-strip" id="c_history"></div>

        <div class="crash-stage">
          <canvas id="c_canvas" class="crash-canvas"></canvas>
          <div class="crash-overlay">
            <div id="c_mult" class="crash-mult">1.00x</div>
            <div id="c_status" class="crash-status">–û–∂–∏–¥–∞–Ω–∏–µ —Å—Ç–∞–≤–∫–∏...</div>
          </div>
        </div>

        <div class="crash-controls">
          <div class="grid cols-2">
            <div>
              <div style="font-size:12px;color:var(--muted);margin-bottom:4px">–°—Ç–∞–≤–∫–∞</div>
              <div class="tile" style="padding:0">
                <button class="btn ghost" style="border:0;padding:0 12px" id="c_half">¬Ω</button>
                <input type="number" id="c_input" class="input" value="100" style="border:0;background:transparent;text-align:center">
                <button class="btn ghost" style="border:0;padding:0 12px" id="c_double">x2</button>
              </div>
            </div>
            <div>
              <div class="auto-row" style="margin-bottom:4px">
                <span>–ê–≤—Ç–æ-—Å—Ç–æ–ø</span>
                <div class="toggle-switch" id="c_auto_toggle"><div class="toggle-knob"></div></div>
              </div>
              <input type="number" id="c_auto_val" class="input" value="2.00" step="0.1" disabled style="opacity:0.5">
            </div>
          </div>
          <button class="btn purple" id="c_action_btn" style="font-size:16px; height:54px">–°–¢–ê–í–ö–ê</button>
        </div>
        
        <button class="btn ghost" id="c_back">‚Üê –ù–∞–∑–∞–¥</button>
      </div>
    `;

    // Bind Elements
    this.els = {
      canvas: document.getElementById('c_canvas'),
      ctx: document.getElementById('c_canvas').getContext('2d'),
      mult: document.getElementById('c_mult'),
      status: document.getElementById('c_status'),
      btn: document.getElementById('c_action_btn'),
      input: document.getElementById('c_input'),
      history: document.getElementById('c_history'),
      autoToggle: document.getElementById('c_auto_toggle'),
      autoVal: document.getElementById('c_auto_val')
    };

    this.resize();
    this.renderHistory();
    this.createStars();
    
    // Event Listeners
    document.getElementById('c_back').onclick = () => { this.stop(); mountOther(); };
    document.getElementById('c_half').onclick = () => this.els.input.value = Math.max(1, Math.floor(this.els.input.value/2));
    document.getElementById('c_double').onclick = () => this.els.input.value = Math.floor(this.els.input.value*2);
    
    this.els.autoToggle.onclick = () => {
      this.els.autoToggle.classList.toggle('active');
      const on = this.els.autoToggle.classList.contains('active');
      this.els.autoVal.disabled = !on;
      this.els.autoVal.style.opacity = on ? '1' : '0.5';
    };

    this.els.btn.onclick = () => this.handleAction();

    this.loop();
    this.startCountdown();
  },

  stop(){
    this.active = false;
    if(this.rafId) cancelAnimationFrame(this.rafId);
  },

  resize(){
    if(!this.els.canvas) return;
    const rect = this.els.canvas.parentElement.getBoundingClientRect();
    this.els.canvas.width = rect.width;
    this.els.canvas.height = rect.height;
  },

  createStars(){
    this.stars = Array(60).fill().map(()=>({
      x: Math.random() * this.els.canvas.width,
      y: Math.random() * this.els.canvas.height,
      s: Math.random() * 2,
      v: Math.random() * 0.5 + 0.2
    }));
  },

  renderHistory(){
    this.els.history.innerHTML = this.history.map(x=>{
      let c = 'low';
      if(x>=10) c='mega'; else if(x>=3) c='high'; else if(x>=2) c='med';
      return `<div class="c-hist-item ${c}">${x.toFixed(2)}x</div>`;
    }).join('');
  },

  handleAction(){
    if(this.phase === 'betting'){
      // Place Bet
      const amt = parseInt(this.els.input.value);
      const bal = getInt('game_balance');
      if(amt > bal){ toast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'); return; }
      if(amt < 1){ toast('–ú–∏–Ω. —Å—Ç–∞–≤–∫–∞ 1'); return; }
      
      if(this.bet){
        // Cancel bet
        setInt('game_balance', bal + this.bet.amount);
        this.bet = null;
        this.els.btn.textContent = '–°–¢–ê–í–ö–ê';
        this.els.btn.classList.remove('danger');
        refreshBalances();
      } else {
        // Make bet
        setInt('game_balance', bal - amt);
        this.bet = { amount: amt, cashedOut: false };
        this.els.btn.textContent = '–û–¢–ú–ï–ù–ê';
        this.els.btn.classList.add('danger');
        refreshBalances();
      }
    } else if(this.phase === 'flying'){
      // Cashout
      if(this.bet && !this.bet.cashedOut){
        this.doCashout();
      }
    }
  },

  doCashout(){
    if(!this.bet || this.bet.cashedOut) return;
    this.bet.cashedOut = true;
    this.bet.profit = Math.floor(this.bet.amount * this.multiplier);
    setInt('game_balance', getInt('game_balance') + this.bet.profit);
    refreshBalances();
    this.els.btn.textContent = `–ó–ê–ë–†–ê–ù–û: ${this.bet.profit} ‚≠ê`;
    this.els.btn.disabled = true;
    this.els.btn.classList.replace('purple', 'success');
    toast(`–í—ã–∏–≥—Ä—ã—à: ${this.bet.profit} ‚≠ê`);
  },

  startCountdown(){
    this.phase = 'betting';
    this.timer = 5.0;
    this.multiplier = 1.00;
    this.crashPoint = this.generateCrash();
    
    this.els.mult.classList.remove('crashed');
    this.els.mult.textContent = '1.00x';
    this.els.btn.disabled = false;
    this.els.btn.classList.remove('success', 'danger');
    this.els.btn.classList.add('purple');
    
    if(this.bet){ 
      // Auto bet from previous round? No, we clear it for safety or keep it logic
      // Here we simple clear visual state but keep bet if it was placed
      this.els.btn.textContent = '–û–¢–ú–ï–ù–ê';
      this.els.btn.classList.add('danger');
    } else {
      this.els.btn.textContent = '–°–¢–ê–í–ö–ê';
    }

    const interval = setInterval(()=>{
      if(!this.active) return clearInterval(interval);
      this.timer -= 0.1;
      this.els.status.textContent = `–°—Ç–∞—Ä—Ç —á–µ—Ä–µ–∑ ${this.timer.toFixed(1)}—Å`;
      if(this.timer <= 0){
        clearInterval(interval);
        this.startFlying();
      }
    }, 100);
  },

  startFlying(){
    this.phase = 'flying';
    this.els.status.textContent = '–†–∞–∫–µ—Ç–∞ –≤ –ø–æ–ª–µ—Ç–µ!';
    
    if(this.bet){
      this.els.btn.textContent = '–ó–ê–ë–†–ê–¢–¨';
      this.els.btn.classList.replace('danger', 'purple');
    } else {
      this.els.btn.textContent = '–°–õ–ï–î–ò–¢–¨';
      this.els.btn.disabled = true;
    }
  },

  crash(){
    this.phase = 'crashed';
    this.els.mult.classList.add('crashed');
    this.els.status.textContent = `–ö—Ä–∞—à –Ω–∞ ${this.multiplier.toFixed(2)}x`;
    this.history.unshift(this.multiplier);
    if(this.history.length > 15) this.history.pop();
    this.renderHistory();
    
    if(this.bet && !this.bet.cashedOut){
      this.els.btn.textContent = '–ü–†–û–ò–ì–†–´–®';
      this.els.btn.classList.replace('purple', 'danger');
    }
    
    this.bet = null;
    setTimeout(() => { if(this.active) this.startCountdown(); }, 3000);
  },

  generateCrash(){
    // Simple implementation of crash logic
    // E.g., 1% instant crash, otherwise pareto distribution
    if(Math.random() < 0.03) return 1.00;
    const e = 100;
    const r = Math.random();
    const res = Math.floor((100*e - r) / (e - r)) / 100;
    // Limit max to avoid insane numbers in demo
    return Math.min(res, 100); 
  },

  loop(){
    if(!this.active) return;
    const ctx = this.els.ctx;
    const w = this.els.canvas.width;
    const h = this.els.canvas.height;

    // Update Logic
    if(this.phase === 'flying'){
      const growth = 0.005 * this.multiplier + 0.001;
      this.multiplier += growth;
      this.els.mult.textContent = this.multiplier.toFixed(2) + 'x';
      
      // Auto stop check
      if(this.bet && !this.bet.cashedOut && this.els.autoToggle.classList.contains('active')){
        const limit = parseFloat(this.els.autoVal.value);
        if(this.multiplier >= limit) this.doCashout();
      }

      if(this.multiplier >= this.crashPoint){
        this.multiplier = this.crashPoint;
        this.els.mult.textContent = this.multiplier.toFixed(2) + 'x';
        this.crash();
      }
    }

    // Draw
    ctx.fillStyle = '#0f1419';
    ctx.fillRect(0,0,w,h);
    
    // Stars background
    ctx.fillStyle = '#fff';
    this.stars.forEach(s => {
      if(this.phase === 'flying') s.x -= s.v * (this.multiplier * 0.5);
      if(s.x < 0) s.x = w;
      ctx.globalAlpha = Math.random() * 0.5 + 0.3;
      ctx.beginPath(); ctx.arc(s.x, s.y, s.s, 0, 6.28); ctx.fill();
    });
    ctx.globalAlpha = 1;

    // Rocket Curve
    if(this.phase !== 'betting'){
        ctx.strokeStyle = this.phase==='crashed' ? '#ef4444' : '#38bdf8';
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.moveTo(0, h);
        
        // Simple curve calc
        let progress = Math.min(1, (this.multiplier - 1) / 5); // Scale visual
        let cx = w * 0.2 + (w * 0.6 * progress);
        let cy = h - (h * 0.8 * progress);
        
        ctx.quadraticCurveTo(w*0.1, h, cx, cy);
        ctx.stroke();

        // Rocket head
        ctx.fillStyle = '#fff';
        ctx.beginPath(); ctx.arc(cx, cy, 6, 0, 6.28); ctx.fill();
        
        // Glow
        if(this.phase === 'flying'){
            ctx.shadowColor = '#38bdf8'; ctx.shadowBlur = 20;
            ctx.beginPath(); ctx.arc(cx, cy, 10, 0, 6.28); ctx.fill();
            ctx.shadowBlur = 0;
        }
    }

    this.rafId = requestAnimationFrame(() => this.loop());
  }
};

function mountCrash(){
  // Stop other games if needed
  markGame('other');
  crashGameApp.init(gameArea);
}

</script>
</body>
</html>
