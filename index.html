<!DOCTYPE html>
<html lang="ru" class="nocopy">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="color-scheme" content="dark light" />
<title>Starify ‚Äî MiniApp</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0a12; --bg2:#140f1f; --text:#f7f4ff; --muted:#b7abc9;
  --line:rgba(255,255,255,.10); --card:rgba(255,255,255,.06);
  --orange:#ff7a18; --orange2:#ffb86b; --violet:#9c5cff; --violet2:#c39aff;
  --danger:#ff3b6b; --ok:#35ffb1; --shadow:0 20px 40px rgba(0,0,0,.35);

  /* —Å–ª–æ—Ç */
  --sym:56px;          /* –≤—ã—Å–æ—Ç–∞ —Å–∏–º–≤–æ–ª–∞ */
  --machine-glow:#ff34c2;
  --machine-edge:#5b3bff;

  /* —Å—Ç–∞–∫–∞–Ω—ã */
  --cup-w: 92px; --cup-h: 86px; --cup-color:#ecf1ff;

  /* –Ω–µ–æ–Ω */
  --neon:#9c5cff; --neon2:#ff7a18;
}

/* –∞–Ω—Ç–∏‚Äë–∫–æ–ø–∏ */
html.nocopy, html.nocopy body, html.nocopy *:not(input):not(textarea){
  -webkit-user-select:none; user-select:none; -webkit-touch-callout:none;
}
html.nocopy ::selection{background:transparent}
html,body{height:100%}
*{box-sizing:border-box}

body{
  margin:0; font-family:"Inter",system-ui,Segoe UI,Roboto,Arial,sans-serif; color:var(--text);
  background:
    radial-gradient(900px 400px at 110% -10%, rgba(156,92,255,.22), transparent 60%),
    radial-gradient(1200px 600px at -10% 10%, rgba(255,122,24,.18), transparent 60%),
    linear-gradient(180deg,var(--bg),var(--bg2));
  display:flex; flex-direction:column; overscroll-behavior:none;
}

/* header/nav */
.header{
  position:sticky; top:0; z-index:10;
  padding:14px 16px; display:flex; align-items:center; gap:12px;
  background:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.2));
  backdrop-filter:blur(14px) saturate(140%); -webkit-backdrop-filter:blur(14px) saturate(140%);
  border-bottom:1px solid var(--line);
}
.page{flex:1; display:flex; flex-direction:column}
.container{
  width:100%; max-width:920px; margin:0 auto;
  padding:14px 14px 90px; display:none; animation:fade .25s ease forwards;
}
.container.active{display:block}

.logo{width:36px; height:36px; border-radius:12px; display:grid; place-items:center; font-weight:800;
  background:conic-gradient(from 0deg, var(--orange2), var(--orange), var(--violet), var(--orange2));
  color:#150b00; box-shadow:var(--shadow)}
.title{font-weight:800; letter-spacing:.3px}
.subtitle{font-size:12px; color:var(--muted)}

.grid{display:grid; gap:12px}
.grid.cols-2{grid-template-columns:1fr}
@media (min-width:560px){ .grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))} }

.card{
  background:var(--card); border:1px solid var(--line); border-radius:18px; padding:14px; box-shadow:var(--shadow);
  transition:.25s transform,.25s background,.25s box-shadow;
}
.card:hover{transform:translateY(-2px)}
.card h3{margin:.2rem 0 .4rem; font-size:16px}
.card p{margin:0; font-size:12px; color:var(--muted)}
.hr{height:1px; background:var(--line); margin:8px 0 2px}
.row{display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
.tile{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px; border-radius:14px; background:rgba(255,255,255,.06); border:1px solid var(--line)}

/* inputs & buttons */
.input{
  width:100%; padding:12px 12px; border-radius:14px;
  border:1px solid var(--line); background:rgba(255,255,255,.06);
  color:var(--text); outline:none; background-clip:padding-box;
  transition:border-color .2s, box-shadow .2s, transform .1s;
}
.input[type=number]::-webkit-outer-spin-button,
.input[type=number]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0 }
.input[type=number]{ -moz-appearance:textfield }
.input:focus{
  border-color: rgba(255,186,107,.6);
  box-shadow:0 0 0 6px rgba(255,122,24,.15);
  transform:translateY(-1px);
}
.btn{
  appearance:none; border:0; cursor:pointer; padding:12px 14px; border-radius:14px; font-weight:800;
  color:#1b0b00;
  background:linear-gradient(135deg, var(--orange), var(--orange2));
  background-size: 200% 200%;
  box-shadow:0 12px 26px rgba(255,122,24,.35);
  transition:transform .12s,filter .2s, box-shadow .2s, opacity .2s, background-position .4s ease;
}
.btn:active{transform:scale(.98)}
.btn:hover{ transform:translateY(-1px); background-position: 100% 0; box-shadow:0 16px 34px rgba(255,122,24,.45); }
.btn.purple{background:linear-gradient(135deg, var(--violet), var(--violet2)); color:#0c0216; box-shadow:0 12px 26px rgba(156,92,255,.35)}
.btn.purple:hover{ background-position: 0 100%; box-shadow:0 16px 34px rgba(156,92,255,.45); }
.btn.ghost{background:transparent; color:var(--text); border:1px solid var(--line); box-shadow:none}
.btn[disabled]{opacity:.5; pointer-events:none}
.badge{font-size:12px; padding:6px 8px; border-radius:10px; background:rgba(255,255,255,.10); border:1px solid var(--line); color:var(--muted)}
.bigbtn{display:flex; gap:12px}
.bigbtn .btn{flex:1; font-size:15px}

/* bottom nav */
.nav{
  position:sticky; bottom:0; z-index:10;
  display:grid; grid-template-columns:repeat(5,1fr); gap:8px; padding:10px;
  background:linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.55));
  backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px);
  border-top:1px solid var(--line);
}
.tab{
  appearance:none; border:1px solid var(--line); background:rgba(255,255,255,.06); color:#fff;
  padding:12px 8px; border-radius:16px; font-size:12px; display:flex; flex-direction:column; align-items:center; gap:4px
}
.tab span{opacity:.85; font-size:11px}
.tab.active{background:linear-gradient(135deg, rgba(255,122,24,.18), rgba(156,92,255,.18))}

/* –∞–∫—Ç–∏–≤–Ω–∞—è –∏–≥—Ä–∞ –ø–æ–¥—Å–≤–µ—Ç–∫–∞ */
.gbtn{position:relative}
.gbtn.active{outline:2px solid #ffb86b; box-shadow:0 0 0 6px rgba(255,186,107,.15)}

/* –∏–≥—Ä–æ–≤–æ–µ –æ–∫–Ω–æ */
.stage{
  position:relative; height:260px; border-radius:16px; background:rgba(255,255,255,.06);
  border:1px solid var(--line); overflow:hidden; touch-action:none;
}

/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî HOME banners ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
.banners{display:grid; gap:12px}
@media(min-width:560px){ .banners{grid-template-columns:1fr 1fr} }
.banner{
  position:relative; border-radius:16px; overflow:hidden; border:1px solid var(--line);
  background:linear-gradient(160deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  height:120px; display:grid; place-items:center; color:#fff; box-shadow:var(--shadow)
}
.banner .ph{width:100%; height:100%; display:grid; place-items:center; font-weight:800; letter-spacing:.5px; color:#fff8}
.banner .tag{position:absolute; left:12px; top:12px; padding:6px 8px; border-radius:10px; background:rgba(0,0,0,.5); border:1px solid var(--line); font-size:12px}

/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî –°–õ–û–¢‚Äë–ê–í–¢–û–ú–ê–¢ ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
.machine{
  position:relative; width:340px; margin:auto; padding:16px 14px 16px; border-radius:24px;
  background:
    radial-gradient(300px 140px at 50% -20%, rgba(255,52,194,.35), transparent 60%),
    radial-gradient(320px 160px at 50% 120%, rgba(156,92,255,.30), transparent 70%),
    linear-gradient(180deg, #1b1428, #120d1c);
  border:1px solid rgba(255,255,255,.12);
  box-shadow:
    0 0 0 2px rgba(255,255,255,.06) inset,
    0 0 24px var(--machine-glow),
    0 16px 38px rgba(0,0,0,.45);
}
.machine::before{
  content:""; position:absolute; inset:-2px; border-radius:26px;
  background:linear-gradient(135deg, var(--machine-edge), var(--machine-glow), #ffb86b, var(--machine-edge));
  filter:blur(12px); opacity:.45; z-index:-1;
}
/* –≤–µ—Ä—Ö–Ω–∏–π –¥–∏—Å–ø–ª–µ–π */
.marquee{
  height:42px; display:grid; grid-template-columns:repeat(3,1fr); gap:6px; margin-bottom:10px;
}
.seven{
  display:grid; place-items:center; font-weight:900; font-size:22px; letter-spacing:1px;
  border-radius:12px;
  color:#0e041a; text-shadow:0 1px 0 #fff7;
  background:
    radial-gradient(80px 40px at 50% 0%, rgba(255,255,255,.65), transparent 60%),
    linear-gradient(180deg, #47e6ff, #14f5c6);
  box-shadow:inset 0 -6px 14px rgba(0,0,0,.25), 0 6px 16px rgba(78,255,236,.25);
}
/* –±–ª–æ–∫ –±–∞—Ä–∞–±–∞–Ω–æ–≤ */
.slot-wrap{display:grid; place-items:center; gap:8px}
.slot{
  position:relative; width:310px; border-radius:16px; overflow:hidden;
  background:linear-gradient(180deg, #1a1623, #0f0c16);
  border:1px solid var(--line); box-shadow:var(--shadow);
  display:grid; grid-template-columns:repeat(3,1fr); gap:8px; padding:8px;
  height: calc(var(--sym)*3 + 16px);
}
.reel{position:relative; overflow:hidden; border-radius:12px; border:1px solid var(--line); background:linear-gradient(180deg, rgba(255,255,255,.06),rgba(255,255,255,.03)); height:calc(var(--sym)*3)}
.roller{position:absolute; left:0; right:0; top:0; will-change:transform}
.symbol{height:var(--sym); display:grid; place-items:center; font-size:42px; line-height:1}

/* ‚ùô‚ùô –¥–≤–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ –º–µ–∂–¥—É –±–∞—Ä–∞–±–∞–Ω–∞–º–∏ */
.slot .vline{position:absolute; top:8px; bottom:8px; width:2px; border-radius:2px;
  background:linear-gradient(180deg, rgba(255,255,255,.1), rgba(255,255,255,.02));
  box-shadow:0 0 8px rgba(255,255,255,.06);
}
.slot .vline.l1{ left: calc(33.333% - 1px); }
.slot .vline.l2{ left: calc(66.666% - 3px); }

/* —Å—Ç—Ä–µ–ª–æ—á–∫–∏ —Å–≤–µ—Ä—Ö—É */
.slot .top-pointers{position:absolute; left:8px; right:8px; top:2px; height:0; display:grid; grid-template-columns:repeat(3,1fr); pointer-events:none}
.slot .ptr{margin:0 auto; width:0;height:0; border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:10px solid #ffb86b; filter:drop-shadow(0 1px 2px rgba(0,0,0,.7))}

/* –∫–Ω–æ–ø–∫–∞ ¬´–∫—Ä—É—Ç–∏—Ç—å¬ª –≤ –∫–æ—Ä–ø—É—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∞ */
.machine .spinbar{display:grid; place-items:center; margin-top:12px}

/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî –°–¢–ê–ö–ê–ù–´ ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
.cups-ui{display:flex; gap:10px; margin-top:8px}
.cup{position:absolute; width:var(--cup-w); height:var(--cup-h); will-change:transform; z-index:2; transition:transform .22s ease; border-radius:24px; transform-style:preserve-3d}
.cup::before{
  content:"";
  position:absolute; inset:4px 10px 8px; 
  background:
    linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.3)),
    linear-gradient(135deg, rgba(255,255,255,.35), rgba(0,0,0,.08));
  background-blend-mode:screen;
  border:1px solid rgba(0,0,0,.22);
  box-shadow: inset 0 10px 18px rgba(255,255,255,.25), inset 0 -12px 22px rgba(0,0,0,.12);
  border-radius:28px / 22px;
  clip-path: polygon(12% 8%, 88% 8%, 78% 94%, 22% 94%); /* –ø–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–∞—è —Ç—Ä–∞–ø–µ—Ü–∏—è */
  background-color: var(--cup-color);
  transform-origin:50% 50%;
}
.cup.flip::before{ animation: cupFlip .24s ease both; }
@keyframes cupFlip{
  0%{ transform: rotateX(0deg); }
  100%{ transform: rotateX(360deg); }
}
.cup::after{
  content:"";
  position:absolute; left:50%; transform:translateX(-50%);
  width:74%; height:8px; bottom:4px; border-radius:50%;
  background:radial-gradient(closest-side, rgba(0,0,0,.35), transparent 70%);
}
.cup .mark{
  position:absolute; top:12px; left:50%; transform:translateX(-50%);
  width:38px; height:7px; border-radius:4px; opacity:.9;
  box-shadow:0 2px 6px rgba(0,0,0,.25);
  background:linear-gradient(180deg, rgba(255,255,255,.6), rgba(255,255,255,.1)), var(--grad,#ff7a18);
}
.cup[data-variant="dot"] .mark{ width:12px; height:12px; border-radius:50% }
.cup[data-variant="chev"] .mark{
  width:0; height:0; border-left:10px solid transparent; border-right:10px solid transparent; border-top:10px solid #ffd36b; background:none;
}
.ball-sm{
  position:absolute; width:24px; height:24px; border-radius:50%;
  background:radial-gradient(circle at 30% 30%, #ff6b6b, #c72a2a);
  box-shadow:0 8px 14px rgba(0,0,0,.35), inset 0 2px 4px rgba(255,255,255,.45);
  will-change:transform; z-index:1; transition:transform .22s ease, opacity .12s ease;
}

/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî –ö–û–õ–ï–°–û ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
.wheelbox{position:relative; display:grid; place-items:center}
.pointer{
  position:absolute; top:-6px; left:50%; transform:translateX(-50%);
  width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:14px solid #ffd36b;
  filter:drop-shadow(0 2px 6px rgba(255,210,107,.6)) drop-shadow(0 0 10px rgba(255,210,107,.45));
  animation: ptrPulse 1.8s ease-in-out infinite;
}
@keyframes ptrPulse{ 0%,100%{ transform:translateX(-50%) translateY(0)} 50%{ transform:translateX(-50%) translateY(2px)} }

.wheel{
  width:240px;height:240px;border-radius:50%; border:1px solid var(--line);
  background:conic-gradient(#ff7a18 0 45deg,#9c5cff 45deg 90deg,#ffb86b 90deg 135deg,#c39aff 135deg 180deg,#ff7a18 180deg 225deg,#9c5cff 225deg 270deg,#ffb86b 270deg 315deg,#c39aff 315deg 360deg); 
  box-shadow:
    0 0 30px rgba(156,92,255,.45),
    0 0 60px rgba(255,122,24,.2),
    inset 0 0 22px rgba(0,0,0,.35);
  display:grid; place-items:center; will-change:transform;
}
.wheel .labels{position:absolute; inset:0; display:grid; place-items:center; font-size:13px; color:#120914; font-weight:800; opacity:.95; pointer-events:none}
.wlabel{position:absolute; transform-origin:50% 100%; top:50%; left:50%}

/* —Å–µ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –∏–≥—Ä: 2 —Å–≤–µ—Ä—Ö—É, ¬´–ö–æ–ª–µ—Å–æ¬ª —Å–Ω–∏–∑—É –ø–æ —Ü–µ–Ω—Ç—Ä—É */
.games-grid{display:grid; gap:10px; grid-template-columns:1fr 1fr}
.games-grid .span2{ grid-column: 1 / span 2; display:flex; justify-content:center }
.games-grid .span2 .btn{ min-width:180px }

/* toast */
.toast{position:fixed; left:50%; bottom:120px; transform:translateX(-50%) translateY(20px); background:rgba(0,0,0,.8);
  border:1px solid var(--line); color:#fff; padding:10px 14px; border-radius:12px; opacity:0; pointer-events:none; transition:opacity .2s, transform .2s; font-size:13px}
.toast.show{opacity:1; transform:translateX(-50%) translateY(0)}
@keyframes fade{from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:translateY(0)}}
</style>
</head>
<body>
  <div class="header">
    <div class="logo">ü¶á</div>
    <div>
      <div class="title">Starify</div>
      <div class="subtitle">–º–∞–≥–∞–∑–∏–Ω ‚Ä¢ –º–∏–Ω–∏-–∏–≥—Ä—ã ‚Ä¢ —Ä–µ—Ñ–µ—Ä–∞–ª–∫–∞</div>
    </div>
    <div style="margin-left:auto" class="badge" id="userBadge">@guest</div>
  </div>

  <div class="page">
    <!-- HOME -->
    <section class="container active" id="home">
      <div class="card">
        <h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Starify üé∞</h3>

        <!-- –±–∞–Ω–Ω–µ—Ä—ã -->
        <div class="banners" style="margin-top:8px">
          <a class="banner" href="https://t.me/your_channel" target="_blank" rel="noopener">
            <div class="tag">–ù–∞—à Telegram‚Äë–∫–∞–Ω–∞–ª</div>
            <div class="ph">Photo1</div>
          </a>
          <a class="banner" href="https://t.me/your_chat" target="_blank" rel="noopener">
            <div class="tag">–ù–∞—à Telegram‚Äë—á–∞—Ç</div>
            <div class="ph">Photo2</div>
          </a>
        </div>

        <div class="bigbtn" style="margin-top:14px">
          <button class="btn" data-tab-go="shop">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
          <button class="btn purple" data-tab-go="games">üé≤ –ò–≥—Ä—ã</button>
          <button class="btn ghost" data-tab-go="ref">ü§ù –†–µ—Ñ–µ—Ä–∞–ª–∫–∞</button>
        </div>
      </div>
    </section>

    <!-- SHOP -->
    <section class="container" id="shop">
      <div class="card">
        <h3>–ú–∞–≥–∞–∑–∏–Ω</h3>
        <p>–í—ã–±–µ—Ä–∏ –∑–≤—ë–∑–¥—ã –∏–ª–∏ Premium. –°—Ä–∞–∑—É –ø–µ—Ä–µ–π–¥—ë–º –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é.</p>
        <div class="hr"></div>

        <div class="grid cols-2" style="margin-top:6px">
          <!-- Stars -->
          <div class="card" style="background:linear-gradient(180deg,rgba(255,122,24,.10),rgba(255,255,255,.06))">
            <h3>‚≠ê –ó–≤—ë–∑–¥—ã</h3>
            <div class="grid" id="starsQuick"></div>
            <div class="hr"></div>
            <div class="tile">
              <div style="flex:1">
                <div class="badge" style="margin-bottom:6px">–î—Ä—É–≥–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</div>
                <input id="customStars" class="input" type="number" min="1" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ">
              </div>
              <button class="btn purple" id="buyCustomStars">–£–∫–∞–∑–∞—Ç—å</button>
            </div>
          </div>

          <!-- Premium -->
          <div class="card" style="background:linear-gradient(180deg,rgba(156,92,255,.12),rgba(255,255,255,.06))">
            <h3>üíé Premium</h3>
            <div class="grid" id="premiumPlans"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- CHECKOUT -->
    <section class="container" id="checkout">
      <div class="card">
        <h3>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h3>
        <p id="checkoutWhat">–í—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä</p>
        <div class="hr"></div>
        <div class="grid">
          <input id="username" class="input" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ @username –ø–æ–ª—É—á–∞—Ç–µ–ª—è">
          <input id="amount" class="input" type="number" min="1" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (–¥–ª—è –∑–≤—ë–∑–¥)">
          <button class="btn" id="proceed">–ü—Ä–∏–æ–±—Ä–µ—Å—Ç–∏</button>
          <button class="btn ghost" data-tab-go="shop">–ù–∞–∑–∞–¥ –≤ –º–∞–≥–∞–∑–∏–Ω</button>
        </div>
      </div>
    </section>

    <!-- GAMES -->
    <section class="container" id="games">
      <div class="card">
        <h3>–ú–∏–Ω–∏‚Äë–∏–≥—Ä—ã</h3>

        <div class="games-grid" style="margin-top:8px">
          <button class="btn gbtn" data-game="slot">üé∞ –°–ª–æ—Ç</button>
          <button class="btn purple gbtn" data-game="cups">ü•§ –°—Ç–∞–∫–∞–Ω—ã</button>
          <div class="span2">
            <button class="btn ghost gbtn" data-game="wheel">üß≠ –ö–æ–ª–µ—Å–æ</button>
          </div>
        </div>
      </div>

      <div id="gameArea" class="grid" style="margin-top:6px"></div>
    </section>

    <!-- REF -->
    <section class="container" id="ref">
      <div class="card">
        <h3>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h3>
        <p>–ü–æ–¥–µ–ª–∏—Å—å —Å—Å—ã–ª–∫–æ–π ‚Äî –¥—Ä—É–≥ –ø–æ–ª—É—á–∏—Ç –±–æ–Ω—É—Å, –∞ —Ç—ã –±–æ–Ω—É—Å –∑–≤—ë–∑–¥–∞–º–∏.</p>
        <div class="hr"></div>
        <div class="row" style="margin-top:8px">
          <input id="refLink" class="input" readonly value="https://t.me/your_bot_here?start=ref_0000">
          <button class="btn purple" id="copyRef">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
      </div>
    </section>

    <!-- PROFILE -->
    <section class="container" id="profile">
      <div class="card">
        <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
        <p id="whoami">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ–¥—Ç—è–Ω–µ—Ç—Å—è –∏–∑ Telegram, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ.</p>
        <div class="hr"></div>
        <div class="grid">
          <div class="tile"><div>üéÆ –ò–≥—Ä–æ–≤–æ–π –±–∞–ª–∞–Ω—Å</div><div id="gameBal">0 ‚≠ê</div></div>
          <div class="tile"><div>ü§ù –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å</div><div id="refBal">0 ‚≠ê</div></div>
        </div>
        <div class="row" style="margin-top:8px">
          <button class="btn ghost" id="closeBtn">–ó–∞–∫—Ä—ã—Ç—å MiniApp</button>
        </div>
      </div>
    </section>
  </div>

  <nav class="nav">
    <button class="tab active" data-tab="home">üè†<span>–î–æ–º</span></button>
    <button class="tab" data-tab="shop">üõí<span>–ú–∞–≥–∞–∑–∏–Ω</span></button>
    <button class="tab" data-tab="games">üé≤<span>–ò–≥—Ä—ã</span></button>
    <button class="tab" data-tab="ref">ü§ù<span>–†–µ—Ñ–µ—Ä–∞–ª–∫–∞</span></button>
    <button class="tab" data-tab="profile">üë§<span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
  </nav>

  <div class="toast" id="toast">–ì–æ—Ç–æ–≤–æ!</div>

<script>
/* Telegram + —Ç–µ–º–∞ */
const tg = window.Telegram?.WebApp;
function applyTheme(){
  if(!tg) return;
  const t = tg.themeParams || {};
  document.documentElement.style.setProperty('--line', t.section_separator_color || 'rgba(255,255,255,.10)');
}
(function hydrateUser(){
  try{
    const user = tg?.initDataUnsafe?.user;
    if(user){
      document.getElementById('userBadge').textContent = user.username ? '@'+user.username : (user.first_name||'user');
      document.getElementById('whoami').textContent = `–¢—ã: ${user.first_name||''} ${user.last_name||''} ${user.username?'(@'+user.username+')':''}`;
      const link = `https://t.me/${tg?.initDataUnsafe?.receiver?.username || 'your_bot_here'}?start=ref_${user.id}`;
      document.getElementById('refLink').value = link;
    }
  }catch{}
})();

/* Banners balances (–¥–µ–º–æ) */
(function balances(){
  const g = parseInt(localStorage.getItem('game_balance')||'0',10);
  const r = parseInt(localStorage.getItem('ref_balance')||'0',10);
  document.getElementById('gameBal').textContent = `${isNaN(g)?0:g} ‚≠ê`;
  document.getElementById('refBal').textContent = `${isNaN(r)?0:r} ‚≠ê`;
})();

/* Toast + –≤–∫–ª–∞–¥–∫–∏ */
const toast=(m='–ì–æ—Ç–æ–≤–æ!')=>{const el=document.getElementById('toast'); el.textContent=m; el.classList.add('show'); setTimeout(()=>el.classList.remove('show'),1200);};
function openTab(id){
  if(anim.busy) return;
  document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active',t.dataset.tab===id));
  document.querySelectorAll('.container').forEach(s=>s.classList.toggle('active',s.id===id));
}
document.querySelectorAll('.tab').forEach(t=>t.onclick=()=>openTab(t.dataset.tab));
document.querySelectorAll('[data-tab-go]').forEach(b=>b.onclick=()=>openTab(b.dataset.tabGo));

/* –ú–∞–≥–∞–∑–∏–Ω */
const starsQuick=[500,1000,2500,5000];
const plans=[{name:'3 –º–µ—Å—è—Ü–∞',plan:'3m'},{name:'6 –º–µ—Å—è—Ü–µ–≤',plan:'6m'},{name:'12 –º–µ—Å—è—Ü–µ–≤',plan:'12m'}];

const elStarsQuick=document.getElementById('starsQuick');
starsQuick.forEach(q=>{
  const c=document.createElement('div'); c.className='tile';
  c.innerHTML=`<div>‚≠ê ${q.toLocaleString('ru-RU')}</div><button class="btn" data-buy-stars="${q}">–ö—É–ø–∏—Ç—å</button>`;
  elStarsQuick.appendChild(c);
});
const elPlans=document.getElementById('premiumPlans');
plans.forEach(p=>{
  const c=document.createElement('div'); c.className='tile';
  c.innerHTML=`<div>${p.name}</div><button class="btn purple" data-buy-premium="${p.plan}">–ü—Ä–∏–æ–±—Ä–µ—Å—Ç–∏</button>`;
  elPlans.appendChild(c);
});

let checkoutState={type:null, label:'', qty:null, plan:null};
function goCheckout(state){
  checkoutState=state;
  const what=document.getElementById('checkoutWhat');
  const amount=document.getElementById('amount');
  const btn=document.getElementById('proceed');
  if(state.type==='stars'){
    what.textContent=`–ü–æ–∫—É–ø–∫–∞ –∑–≤—ë–∑–¥: ${state.qty? state.qty+' ‚≠ê' : '—É–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∏–∂–µ'}`;
    amount.value = state.qty || '';
    amount.placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤—ë–∑–¥";
    amount.parentElement.style.display='';
    btn.textContent='–û—Ñ–æ—Ä–º–∏—Ç—å';
  } else {
    what.textContent=`–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ Telegram Premium: ${state.plan}`;
    amount.value=''; amount.parentElement.style.display='none';
    btn.textContent='–ü—Ä–∏–æ–±—Ä–µ—Å—Ç–∏';
  }
  openTab('checkout'); document.getElementById('username').focus();
}
document.addEventListener('click',(e)=>{
  const s=e.target.closest('[data-buy-stars]'); const p=e.target.closest('[data-buy-premium]');
  if(s){ goCheckout({type:'stars', label:'–ó–≤—ë–∑–¥—ã', qty:parseInt(s.dataset.buyStars,10)}); }
  if(p){ goCheckout({type:'premium', label:'Premium', plan:p.dataset.buyPremium}); }
});
document.getElementById('buyCustomStars').onclick=()=>{
  const qty=parseInt(document.getElementById('customStars').value,10) || null;
  goCheckout({type:'stars', label:'–ó–≤—ë–∑–¥—ã', qty});
};
/* username check */
function validUser(u){ return /^@[a-zA-Z0-9_]{2,32}$/.test(u); }
document.getElementById('proceed').onclick=()=>{
  const u=(document.getElementById('username').value||'').trim();
  if(!validUser(u)){ toast('–í–≤–µ–¥–∏ @username'); return; }
  if(checkoutState.type==='stars'){
    const qty = parseInt(document.getElementById('amount').value||checkoutState.qty||0,10);
    if(!qty || qty<1){ toast('–£–∫–∞–∂–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤—ë–∑–¥'); return; }
    toast(`–ó–∞—è–≤–∫–∞: –ó–≤—ë–∑–¥—ã ‚Üí ${u} ‚Ä¢ ${qty} ‚≠ê`);
  }else if(checkoutState.type==='premium'){
    toast(`–ó–∞—è–≤–∫–∞: Premium ‚Üí ${u} ‚Ä¢ ${checkoutState.plan}`);
  }else{
    toast('–í—ã–±–µ—Ä–∏ —Ç–æ–≤–∞—Ä');
  }
};

/* –∞–Ω—Ç–∏‚Äë–∫–æ–ø–∏ js */
(function antiCopy(){
  const allowSelectionOnInputs=false;
  document.addEventListener('contextmenu', e=>e.preventDefault(), {passive:false});
  document.addEventListener('copy', e=>{ e.preventDefault(); toast('–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ'); }, {passive:false});
  document.addEventListener('cut',  e=>{ e.preventDefault(); }, {passive:false});
  document.addEventListener('selectstart', e=>{
    if(allowSelectionOnInputs){
      const t=e.target; if(t && (t.tagName==='INPUT'||t.tagName==='TEXTAREA')) return;
    }
    e.preventDefault();
  }, {passive:false});
  document.addEventListener('keydown', e=>{
    const k=e.key?.toLowerCase?.()||'';
    if((e.ctrlKey||e.metaKey) && ['c','x','a','s','p','u'].includes(k)){ e.preventDefault(); }
  });
})();

/* ‚Äî‚Äî‚Äî –ò–≥—Ä–æ–≤–æ–π –ª–æ–∫ ‚Äî‚Äî‚Äî */
const gameArea=document.getElementById('gameArea');
const symbols=['üéÉ','üï∑Ô∏è','ü¶á','üï∏Ô∏è','üç¨','7Ô∏è‚É£'];
const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
const rint=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const easeOut=t=>1-Math.pow(1-t,3);

const anim={
  busy:false, current:null,
  async run(name, fn){
    if(this.busy) return;
    this.busy=true; this.current=name;
    setControlsDisabled(true);
    try{ await fn(); }finally{
      this.busy=false; this.current=null; setControlsDisabled(false);
    }
  }
};
function setControlsDisabled(dis){
  document.querySelectorAll('[data-game]').forEach(b=>b.disabled=dis);
  document.querySelectorAll('[data-action]').forEach(b=>b.disabled=dis);
  document.querySelectorAll('.tab').forEach(t=>t.disabled=dis);
}
function markGame(kind){
  document.querySelectorAll('.gbtn').forEach(b=>b.classList.toggle('active', b.dataset.game===kind));
}

/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî SLOT ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
function mountSlot(){
  markGame('slot');
  gameArea.innerHTML='';

  const card=document.createElement('div'); card.className='card';
  const machine=document.createElement('div'); machine.className='machine';

  // –≤–µ—Ä—Ö–Ω–∏–π –¥–∏—Å–ø–ª–µ–π ¬´777¬ª
  const marquee=document.createElement('div'); marquee.className='marquee';
  marquee.innerHTML=`<div class="seven" id="m1">7</div><div class="seven" id="m2">7</div><div class="seven" id="m3">7</div>`;
  machine.appendChild(marquee);

  // –±–∞—Ä–∞–±–∞–Ω—ã
  const wrap=document.createElement('div'); wrap.className='slot-wrap';
  const slot=document.createElement('div'); slot.className='slot';
  slot.innerHTML=`
      <div class="top-pointers"><div class="ptr"></div><div class="ptr"></div><div class="ptr"></div></div>
      <div class="vline l1"></div><div class="vline l2"></div>
      <div class="reel"><div class="roller" id="sl_r1"></div></div>
      <div class="reel"><div class="roller" id="sl_r2"></div></div>
      <div class="reel"><div class="roller" id="sl_r3"></div></div>`;
  wrap.appendChild(slot);

  // –∫–Ω–æ–ø–∫–∞
  const spinbar=document.createElement('div'); spinbar.className='spinbar';
  spinbar.innerHTML=`<button class="btn" id="spinBtn" data-action="spin">–ö—Ä—É—Ç–∏—Ç—å</button>`;
  machine.append(wrap, spinbar);

  // –≤—ã–≤–æ–¥
  const out=document.createElement('span'); out.className='badge'; out.id='slotOut'; out.style.marginTop='6px';
  out.textContent='–£–¥–∞—á–∏!';
  card.append(machine, out);
  gameArea.appendChild(card);

  // –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
  const stack=Array(24).fill(0).flatMap(()=>symbols);
  const reelHTML = stack.map(s=>`<div class="symbol">${s}</div>`).join('');
  ['sl_r1','sl_r2','sl_r3'].forEach(id=>document.getElementById(id).innerHTML=reelHTML);

  const rollers=[document.getElementById('sl_r1'),document.getElementById('sl_r2'),document.getElementById('sl_r3')];
  const itemH=parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--sym'));

  function spinRoller(el, duration){
    const N=symbols.length;
    const k=rint(0, N-1); // –∫–∞–∫–æ–π —Å–∏–º–≤–æ–ª —Ö–æ—Ç–∏–º –≤–∏–¥–µ—Ç—å –≤ –°–†–ï–î–ù–ï–ô —Å—Ç—Ä–æ–∫–µ
    const cycles=rint(11,16);
    const base=cycles*N*itemH;
    const offset = (k-1>=0? k-1 : k-1+N)*itemH; // —Å—Ä–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞
    const target=base + offset;
    const t0=performance.now();
    return new Promise(res=>{
      function step(now){
        const p=Math.min(1,(now-t0)/duration);
        const accel = Math.min(1, p*2);
        const ease = accel<0.7 ? accel*accel*1.3 : easeOut(p);
        const y = ease*target;
        el.style.transform=`translateY(-${y}px)`;
        if(p<1) requestAnimationFrame(step);
        else { const rest = Math.round(y/itemH)*itemH; el.style.transform=`translateY(-${rest}px)`; res(k); }
      }
      requestAnimationFrame(step);
    });
  }
  async function spinOnce(){
    await anim.run('slot', async()=>{
      out.textContent='–ö—Ä—É—Ç–∏–º...';
      const [i1,i2,i3] = await Promise.all([
        spinRoller(rollers[0], 720),
        spinRoller(rollers[1], 800),
        spinRoller(rollers[2], 880),
      ]);
      const a=symbols[i1], b=symbols[i2], c=symbols[i3];

      // –æ–±–Ω–æ–≤–∏–º –≤–µ—Ä—Ö–Ω–∏–π –¥–∏—Å–ø–ª–µ–π
      const m1=document.getElementById('m1'), m2=document.getElementById('m2'), m3=document.getElementById('m3');
      if(a===b && b===c){ m1.textContent='7'; m2.textContent='7'; m3.textContent='7'; out.textContent=`–ü–æ–±–µ–¥–∞! ${a}${b}${c}`; }
      else { m1.textContent=a; m2.textContent=b; m3.textContent=c; out.textContent=`${a} | ${b} | ${c}`; }
    });
  }
  document.getElementById('spinBtn').onclick=spinOnce;
}

/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî CUPS ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
function mountCups(){
  markGame('cups');
  gameArea.innerHTML='';
  const card=document.createElement('div'); card.className='card';
  const stage=document.createElement('div'); stage.className='stage';
  const ui=document.createElement('div'); ui.className='cups-ui';
  const btn=document.createElement('button'); btn.className='btn'; btn.dataset.action='mix'; btn.textContent='–ù–∞—á–∞—Ç—å';
  ui.appendChild(btn);

  const ball=document.createElement('div'); ball.className='ball-sm';
  stage.appendChild(ball);

  // —Ç—Ä–∏ —Å—Ç–∞–∫–∞–Ω–∞ —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏
  const variants=['stripe','dot','chev'];
  const grads=['linear-gradient(90deg,#ff7a18,#ffb86b)','linear-gradient(90deg,#5bc0ff,#a3e7ff)','linear-gradient(90deg,#9c5cff,#c39aff)'];
  const cups=[0,1,2].map((i)=>{
    const c=document.createElement('div'); c.className='cup'; 
    const mark=document.createElement('div'); mark.className='mark';
    c.appendChild(mark);
    c.dataset.variant = variants[i%variants.length];
    mark.style.setProperty('--grad', grads[i%grads.length]);
    stage.appendChild(c); 
    return c;
  });

  card.append(stage, ui); gameArea.appendChild(card);

  const baseY=150, upY=72, ballY=baseY+18;

  const posX=()=>{ const W=stage.clientWidth; const center=W/2; const gap=Math.min(160, Math.max(110, (W-220)/2)); return [center-gap, center, center+gap]; };

  let cupsAtPos=[cups[0], cups[1], cups[2]];
  let ballPosIndex=1;

  function placeAll(raised){
    const xs=posX();
    cupsAtPos.forEach((cup,pos)=>{ cup.style.transform=`translate(${xs[pos]}px, ${raised?upY:baseY}px) translate(-50%,-50%)`; });
    ball.style.transform=`translate(${xs[ballPosIndex]}px, ${ballY}px) translate(-50%,-50%)`;
  }

  function swapPos(a,b,ms=200){
    return new Promise(res=>{
      const xs=posX(); 
      const cupA=cupsAtPos[a], cupB=cupsAtPos[b];
      cupsAtPos[a]=cupB; cupsAtPos[b]=cupA;

      cupA.style.transition=`transform ${ms}ms ease`;
      cupB.style.transition=`transform ${ms}ms ease`;
      cupA.style.transform=`translate(${xs[b]}px, ${baseY}px) translate(-50%,-50%)`;
      cupB.style.transform=`translate(${xs[a]}px, ${baseY}px) translate(-50%,-50%)`;

      if(ballPosIndex===a){ ballPosIndex=b; }
      else if(ballPosIndex===b){ ballPosIndex=a; }

      ball.style.transition=`transform ${ms}ms ease`;
      ball.style.transform=`translate(${xs[ballPosIndex]}px, ${ballY}px) translate(-50%,-50%)`;

      setTimeout(res,ms+18);
    });
  }
  function cycle3(dir='left', ms=200){
    return new Promise(res=>{
      const xs=posX();
      if(dir==='left'){ const A=cupsAtPos[0],B=cupsAtPos[1],C=cupsAtPos[2]; cupsAtPos=[B,C,A]; }
      else{ const A=cupsAtPos[0],B=cupsAtPos[1],C=cupsAtPos[2]; cupsAtPos=[C,A,B]; }
      cupsAtPos.forEach((cup,pos)=>{ cup.style.transition=`transform ${ms}ms ease`; cup.style.transform=`translate(${xs[pos]}px, ${baseY}px) translate(-50%,-50%)`; });
      if(dir==='left') ballPosIndex = (ballPosIndex+2)%3; else ballPosIndex = (ballPosIndex+1)%3;
      ball.style.transition=`transform ${ms}ms ease`;
      ball.style.transform=`translate(${xs[ballPosIndex]}px, ${ballY}px) translate(-50%,-50%)`;
      setTimeout(res,ms+18);
    });
  }
  function fakeSwap(ms=180){
    return new Promise(async res=>{
      const xs=posX();
      const victim = rint(0,2);
      const cup=cupsAtPos[victim];
      cup.classList.add('flip'); // –±—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç
      cup.style.transition=`transform ${ms}ms ease`;
      cup.style.transform=`translate(${xs[victim]}px, ${upY}px) translate(-50%,-50%)`;
      await new Promise(r=>setTimeout(r,ms));
      const to = (victim+ (Math.random()<.5?1:2))%3;
      ballPosIndex = to;
      ball.style.transition=`transform ${ms}ms ease`;
      ball.style.transform=`translate(${xs[to]}px, ${ballY}px) translate(-50%,-50%)`;
      cup.style.transform=`translate(${xs[victim]}px, ${baseY}px) translate(-50%,-50%)`;
      setTimeout(()=>{ cup.classList.remove('flip'); res(); },ms+30);
    });
  }

  async function startRound(){
    await anim.run('cups', async()=>{
      // —Å—Ç–∞—Ä—Ç: –ø–æ–∫–∞–∑–∞—Ç—å —à–∞—Ä
      ballPosIndex=1;
      placeAll(true);
      await new Promise(r=>setTimeout(r,600));

      // –æ–ø—É—Å—Ç–∏—Ç—å —Å—Ç–∞–∫–∞–Ω—ã —Å ¬´flip¬ª, —Å–ø—Ä—è—Ç–∞—Ç—å —à–∞—Ä
      const xs=posX();
      cupsAtPos.forEach(c=>{ c.classList.add('flip'); c.style.transition='transform .24s ease'; });
      cupsAtPos.forEach((cup,pos)=>{ cup.style.transform=`translate(${xs[pos]}px, ${baseY}px) translate(-50%,-50%)`; });
      setTimeout(()=>cupsAtPos.forEach(c=>c.classList.remove('flip')),260);
      await new Promise(r=>setTimeout(r,260));
      ball.style.opacity='0';

      // —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è ‚â† —Å—Ç–∞—Ä—Ç–æ–≤–æ–π
      let target=rint(0,2); while(target===1) target=rint(0,2);

      // —Å–ª–æ–∂–Ω–∞—è –º–µ—à–∞–Ω–∏–Ω–∞ 16‚Äì26 —à–∞–≥–æ–≤
      const steps=rint(16,26);
      for(let i=0;i<steps;i++){
        const pick=Math.random();
        if(pick<0.5)      await swapPos(rint(0,2), rint(0,2), rint(160,230));
        else if(pick<0.85)await cycle3(Math.random()<.5?'left':'right', rint(180,240));
        else              await fakeSwap(rint(160,200));
      }
      if(ballPosIndex!==target) await swapPos(ballPosIndex, target, rint(200,240));

      // –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const guessPos = await new Promise(resolve=>{
        cupsAtPos.forEach((cup,pos)=>{ cup.style.cursor='pointer'; cup.onclick=()=>resolve(pos); });
      });
      cupsAtPos.forEach(c=>{ c.onclick=null; c.style.cursor='default'; });

      // –ø–æ–¥–Ω—è—Ç—å, –ø–æ–∫–∞–∑–∞—Ç—å —à–∞—Ä
      ball.style.opacity='1';
      cupsAtPos.forEach((cup,pos)=>{
        cup.style.transition='transform .24s ease';
        cup.style.transform=`translate(${xs[pos]}px, ${upY}px) translate(-50%,-50%)`;
      });
      await new Promise(r=>setTimeout(r,240));
      toast(guessPos===ballPosIndex ? '–í–µ—Ä–Ω–æ! üéâ' : '–ú–∏–º–æ');
    });
  }

  placeAll(true);
  btn.onclick=startRound;
}

/* ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî WHEEL (–æ–¥–Ω–æ –∫–æ–ª–µ—Å–æ, —Å–ª—É—á–∞–π–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ) ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî */
function mountWheel(){
  markGame('wheel');
  gameArea.innerHTML='';
  const card=document.createElement('div'); card.className='card';
  const stage=document.createElement('div'); stage.className='stage';

  const box=document.createElement('div'); box.className='wheelbox'; box.style.margin='auto';
  const ptr=document.createElement('div'); ptr.className='pointer';
  const wheel=document.createElement('div'); wheel.className='wheel';
  const labels=document.createElement('div'); labels.className='labels';
  wheel.appendChild(labels); box.append(ptr,wheel); stage.appendChild(box);

  const btn=document.createElement('button'); btn.className='btn'; btn.dataset.action='spinwheel'; btn.textContent='–ö—Ä—É—Ç–∏—Ç—å';
  btn.style.marginTop='10px';
  card.append(stage, btn);
  gameArea.appendChild(card);

  const SEG = Array.from({length:8}, ()=> Math.random()<0.4 ? '–ù–∏—á–µ–≥–æ' : `+${rint(15,100)} ‚≠ê`);
  const n=SEG.length, step=360/n;
  SEG.forEach((txt,i)=>{
    const lbl=document.createElement('div');
    lbl.className='wlabel';
    const ang=i*step + step/2;
    lbl.style.transform=`translate(-50%,-50%) rotate(${ang}deg) translateY(-92px) rotate(${-ang}deg)`;
    lbl.textContent=txt; labels.appendChild(lbl);
  });

  let angle=rint(0,359); // —Å–ª—É—á–∞–π–Ω—ã–π —Å—Ç–∞—Ä—Ç
  wheel.style.transform=`rotate(${angle}deg)`;

  async function spinWheel(){
    await anim.run('wheel', async()=>{
      const target = rint(0,n-1);
      const dir = Math.random()<0.5 ? 1 : -1; // cw / ccw
      const turns = 5 + Math.random()*2;
      const base = target*step + step/2;
      const end = dir * (turns*360 + (360 - base)); // —Ç–∞–∫, —á—Ç–æ–± —É–∫–∞–∑–∞—Ç–µ–ª—å —Å–≤–µ—Ä—Ö—É –Ω–∞ —Ü–µ–ª–µ–≤–æ–π —Å–µ–≥–º–µ–Ω—Ç
      const start=angle; const dur=1500 + rint(0,600);

      await new Promise(res=>{
        const t0=performance.now();
        function loop(now){
          const p=Math.min(1,(now-t0)/dur);
          const e = p<0.85 ? (1-Math.pow(1-p,2.6)) : (1 - Math.pow(1-p,1.2)*0.2);
          angle = start + (end)*e;
          wheel.style.transform=`rotate(${angle}deg)`;
          if(p<1) requestAnimationFrame(loop); else res();
        }
        requestAnimationFrame(loop);
      });
      toast(`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${SEG[target]}`);
    });
  }
  btn.onclick=spinWheel;
}

/* –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∏–≥—Ä */
function showGame(kind){
  if(anim.busy) return;
  if(kind==='slot')  mountSlot();
  if(kind==='cups')  mountCups();
  if(kind==='wheel') mountWheel();
}
document.querySelectorAll('[data-game]').forEach(b=>b.onclick=()=>showGame(b.dataset.game));
showGame('slot'); // —Å—Ç–∞—Ä—Ç

/* –ø—Ä–æ—á–µ–µ */
document.getElementById('copyRef').onclick=async()=>{
  try{ await navigator.clipboard.writeText(document.getElementById('refLink').value); toast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞'); }
  catch{ toast('–°–∫–æ–ø–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é'); }
};
document.getElementById('closeBtn').onclick=()=>tg?.close?.();

tg?.ready?.(); tg?.expand?.(); applyTheme();
</script>
</body>
</html>
